<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>User</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            User 
            
                <span class="parent">&lt; 
                    
                    ActiveRecord::Base
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/app/models/user_rb.html">app/models/user.rb</a></li>
            
            <li><a href="../files/lib/autoload/user/authentication_rb.html">lib/autoload/user/authentication.rb</a></li>
            
            <li><a href="../files/lib/autoload/user/confirmation_rb.html">lib/autoload/user/confirmation.rb</a></li>
            
            <li><a href="../files/lib/autoload/user/reset_password_rb.html">lib/autoload/user/reset_password.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h3 id="class-User-label-Description">Description</h3>

<p>ActiveRecord class that corresponds to the table <code>users</code>.</p>

<h3 id="class-User-label-Fields">Fields</h3>
<ul><li>
<p><em>email</em>: unique identifier for the user, and e-mail address</p>
</li><li>
<p><em>name</em>: name of the user</p>
</li><li>
<p><em>surname</em>: surname of the user</p>
</li><li>
<p><em>school_level_id</em>: reference to the user&#39;s <a
href="SchoolLevel.html">SchoolLevel</a></p>
</li><li>
<p><em>encrypted_password</em>: password, encrypted with SecureRandom</p>
</li><li>
<p><em>confirmed</em>: boolean, <code>true</code> if the user has completed
the registration procedure clicking on a link he received by email</p>
</li><li>
<p><em>active</em>: boolean, false if the user is banned</p>
</li><li>
<p><em>location_id</em>: location of the user</p>
</li><li>
<p><em>purchase_id</em>: references to the <a
href="Purchase.html">Purchase</a> that allows the user to log in</p>
</li><li>
<p><em>confirmation_token</em>: token used for confirmation, generated
automaticly</p>
</li><li>
<p><em>password_token</em>: token used for resetting the password, generated
automaticly</p>
</li><li>
<p><em>metadata</em>:</p>
</li><li>
<p><code>video_editor_cache</code>: cache of the <a
href="Video.html">Video</a> Editor (screenshot of the last video edited)</p>
</li><li>
<p><code>audio_editor_cache</code>: cache of the <a
href="Audio.html">Audio</a> Editor (screenshot of the last audio edited)</p>
</li></ul>

<h3 id="class-User-label-Associations">Associations</h3>
<ul><li>
<p><em>bookmarks</em>: links created by this user elements or lessons (see <a
href="Bookmark.html">Bookmark</a>) (<em>has_many</em>)</p>
</li><li>
<p><em>notifications</em>: notifications of this user (see <a
href="Notification.html">Notification</a>) (<em>has_many</em>)</p>
</li><li>
<p><em>likes</em>: list of “I like you” registered by this user on other
users&#39; lessons (see <a href="Like.html">Like</a>) (<em>has_many</em>)</p>
</li><li>
<p><em>lessons</em>: list of lessons created by this user (see <a
href="Lesson.html">Lesson</a>) (<em>has_many</em>)</p>
</li><li>
<p><em>media_elements</em>: list of elements loaded or created by this user
(includes also public elements, which are moved into the public database of
the application, but they still record who was the user who first created
them (see <a href="MediaElement.html">MediaElement</a>, <a
href="Audio.html">Audio</a>, <a href="Image.html">Image</a>, <a
href="Video.html">Video</a>) (<em>has_many</em>)</p>
</li><li>
<p><em>reports</em>: reports sent by this user about elements or lessons (see
<a href="Report.html">Report</a>) (<em>has_many</em>)</p>
</li><li>
<p><em>users_subjects</em>: list of instances of this subject associated to
this user through records of <a href="UsersSubject.html">UsersSubject</a>
(<em>has_many</em>)</p>
</li><li>
<p><em>subjects</em>: list of subjects associated to this user (through the
association <code>users_subjects</code>) (see <a
href="Subject.html">Subject</a>) (<em>has_and_belongs_to_many</em>)</p>
</li><li>
<p><em>virtual_classroom_lessons</em>: list of lessons present in the
user&#39;s Virtual Classroom (see <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a>)
(<em>has_many</em>)</p>
</li><li>
<p><em>mailing_list_groups</em>: all the mailing list groups that this user
created (see <a href="MailingListGroup.html">MailingListGroup</a>)
(<em>has_many</em>)</p>
</li><li>
<p><em>school_level</em>: the <a href="SchoolLevel.html">SchoolLevel</a>
associated to this user (<em>belongs_to</em>)</p>
</li><li>
<p><em>location</em>: the <a href="Location.html">Location</a> associated to
this user (<em>belongs_to</em>, it can be nil)</p>
</li><li>
<p><em>documents</em>: documents uploaded by the user (see <a
href="Document.html">Document</a>) (<em>has_many</em>)</p>
</li><li>
<p><em>purchase</em>: the <a href="Purchase.html">Purchase</a> allowing the
user to be logged in with his account</p>
</li></ul>

<h3 id="class-User-label-Validations">Validations</h3>
<ul><li>
<p><em>presence</em> of <code>email</code>, <code>name</code>,
<code>surname</code></p>
</li><li>
<p><em>presence</em> with numericality greater than 0 and presence of
associated object for <code>school_level_id</code></p>
</li><li>
<p><em>numericality</em> greater than 0 and allow_nil and eventually presence
of associated object for <code>location_id</code> and
<code>purchase_id</code> (for the location, it&#39;s also checked that the
subclass is the last in the locations chain, see <a
href="Location.html">Location</a>)</p>
</li><li>
<p><em>confirmation</em> of <code>encrypted_password</code> (the attribute
password must coincide with its confirmation provided by the user): this
validation uses the private attribute <code>password_confirmation</code>,
associated to password</p>
</li><li>
<p><em>confirmation</em> of <code>email</code> (the attribute email must
coincide with its confirmation provided by the user): this validation uses
the private attribute <code>email_confirmation</code></p>
</li><li>
<p><em>presence</em> of at least one associated record of <a
href="UsersSubject.html">UsersSubject</a></p>
</li><li>
<p><em>uniqueness</em> of <code>email</code></p>
</li><li>
<p><em>length</em> of <code>name</code> and <code>surname</code> (maximum 255)</p>
</li><li>
<p><em>length</em> of the attribute password associated to
<code>encrypted_password</code> (the maximum is configured in settings.yml,
same as the minimum, but the minimum can be null, in which case the minimum
size is one character). Since this attribute doesn&#39;t correspond to a
field, the validation is forced only when the user is created: when the
user is updated, instead, the validation allows <code>nil</code> and
<code>blank</code> values, in case the user doesn&#39;t want to change his
password</p>
</li><li>
<p><em>inclusion</em> of <code>active</code> and <code>confirmed</code> in
[<code>true</code>, <code>false</code>]</p>
</li><li>
<p><em>correctness</em> of <code>email</code> as an e-mail address</p>
</li><li>
<p><em>modifications</em> <em>not</em> <em>available</em> for
<code>email</code> if the user is not a new record</p>
</li><li>
<p><em>acceptance</em> of each policy configured in settings.yml</p>
</li><li>
<p><em>control</em> that accounts_number in purchase is less than users count
associated to that <a href="Purchase.html">Purchase</a> (if purchase_id is
not nil)</p>
</li></ul>

<h3 id="class-User-label-Callbacks">Callbacks</h3>
<ol><li>
<p><em>before_destroy</em> destroys associated instances of subjects (see <a
href="UsersSubject.html">UsersSubject</a>)</p>
</li></ol>

<h3 id="class-User-label-Database+callbacks">Database callbacks</h3>
<ol><li>
<p><em>cascade</em> <em>destruction</em> for the associated table <a
href="MailingListGroup.html">MailingListGroup</a></p>
</li></ol>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">MODULE</span>
          <a href="User/Authentication.html">User::Authentication</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="User/Confirmation.html">User::Confirmation</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="User/ResetPassword.html">User::ResetPassword</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-accept_policies">accept_policies</a>,
              </li>
            
              
              <li>
                <a href="#method-c-admin">admin</a>,
              </li>
            
              
              <li>
                <a href="#method-i-admin-3F">admin?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-admin_quick_uploading_cache">admin_quick_uploading_cache</a>,
              </li>
            
              
              <li>
                <a href="#method-i-audio_editor_available">audio_editor_available</a>,
              </li>
            
              
              <li>
                <a href="#method-i-audio_editor_cache">audio_editor_cache</a>,
              </li>
            
              
              <li>
                <a href="#method-i-audio_editor_cache-21">audio_editor_cache!</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-base_location">base_location</a>,
              </li>
            
              
              <li>
                <a href="#method-i-bookmark">bookmark</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-create_lesson">create_lesson</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-destroy_notification_and_reload">destroy_notification_and_reload</a>,
              </li>
            
              
              <li>
                <a href="#method-i-destroy_with_dependencies">destroy_with_dependencies</a>,
              </li>
            
              
              <li>
                <a href="#method-i-dislike">dislike</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-empty_playlist">empty_playlist</a>,
              </li>
            
              
              <li>
                <a href="#method-i-empty_virtual_classroom">empty_virtual_classroom</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-full_name">full_name</a>,
              </li>
            
              
              <li>
                <a href="#method-i-full_virtual_classroom">full_virtual_classroom</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-get_full_names">get_full_names</a>,
              </li>
            
              
              <li>
                <a href="#method-i-get_tags_associated_to_lesson_search">get_tags_associated_to_lesson_search</a>,
              </li>
            
              
              <li>
                <a href="#method-i-get_tags_associated_to_media_element_search">get_tags_associated_to_media_element_search</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-init_validation">init_validation</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-like">like</a>,
              </li>
            
              
              <li>
                <a href="#method-c-location_association_class">location_association_class</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-new_mailing_list_name">new_mailing_list_name</a>,
              </li>
            
              
              <li>
                <a href="#method-i-notifications_visible_block">notifications_visible_block</a>,
              </li>
            
              
              <li>
                <a href="#method-i-number_notifications_not_seen">number_notifications_not_seen</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>O</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-own_documents">own_documents</a>,
              </li>
            
              
              <li>
                <a href="#method-i-own_lessons">own_lessons</a>,
              </li>
            
              
              <li>
                <a href="#method-i-own_mailing_list_groups">own_mailing_list_groups</a>,
              </li>
            
              
              <li>
                <a href="#method-i-own_media_elements">own_media_elements</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-parent_locations">parent_locations</a>,
              </li>
            
              
              <li>
                <a href="#method-i-playlist">playlist</a>,
              </li>
            
              
              <li>
                <a href="#method-i-playlist_for_viewer">playlist_for_viewer</a>,
              </li>
            
              
              <li>
                <a href="#method-i-playlist_full-3F">playlist_full?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-registration_policies">registration_policies</a>,
              </li>
            
              
              <li>
                <a href="#method-i-remove_from_admin_quick_uploading_cache">remove_from_admin_quick_uploading_cache</a>,
              </li>
            
              
              <li>
                <a href="#method-i-report_lesson">report_lesson</a>,
              </li>
            
              
              <li>
                <a href="#method-i-report_media_element">report_media_element</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-save_in_admin_quick_uploading_cache">save_in_admin_quick_uploading_cache</a>,
              </li>
            
              
              <li>
                <a href="#method-i-search_lessons">search_lessons</a>,
              </li>
            
              
              <li>
                <a href="#method-i-search_lessons_with_tag">search_lessons_with_tag</a>,
              </li>
            
              
              <li>
                <a href="#method-i-search_lessons_without_tag">search_lessons_without_tag</a>,
              </li>
            
              
              <li>
                <a href="#method-i-search_media_elements">search_media_elements</a>,
              </li>
            
              
              <li>
                <a href="#method-i-search_media_elements_with_tag">search_media_elements_with_tag</a>,
              </li>
            
              
              <li>
                <a href="#method-i-search_media_elements_without_tag">search_media_elements_without_tag</a>,
              </li>
            
              
              <li>
                <a href="#method-i-subject_ids-3D">subject_ids=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-suggested_lessons">suggested_lessons</a>,
              </li>
            
              
              <li>
                <a href="#method-i-suggested_media_elements">suggested_media_elements</a>,
              </li>
            
              
              <li>
                <a href="#method-i-super_admin-3F">super_admin?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-tot_notifications_number">tot_notifications_number</a>,
              </li>
            
              
              <li>
                <a href="#method-i-trial-3F">trial?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-trial_to_expiration">trial_to_expiration</a>,
              </li>
            
              
              <li>
                <a href="#method-i-trial_to_expiration_percentage">trial_to_expiration_percentage</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>V</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-validate_accounts_number_for_purchase">validate_accounts_number_for_purchase</a>,
              </li>
            
              
              <li>
                <a href="#method-i-validate_associations">validate_associations</a>,
              </li>
            
              
              <li>
                <a href="#method-i-validate_email">validate_email</a>,
              </li>
            
              
              <li>
                <a href="#method-i-validate_email_not_changed">validate_email_not_changed</a>,
              </li>
            
              
              <li>
                <a href="#method-i-video_editor_available">video_editor_available</a>,
              </li>
            
              
              <li>
                <a href="#method-i-video_editor_cache">video_editor_cache</a>,
              </li>
            
              
              <li>
                <a href="#method-i-video_editor_cache-21">video_editor_cache!</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="User/Authentication.html">
              User::Authentication
            </a>
          
        </li>
      
        <li>
          
            <a href="User/Confirmation.html">
              User::Confirmation
            </a>
          
        </li>
      
        <li>
          
            <a href="User/ResetPassword.html">
              User::ResetPassword
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">REGISTRATION_POLICIES</td>
            <td>=</td>
            <td class="attr-value">SETTINGS[&#39;user_registration_policies&#39;].map(&amp;:to_sym)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>List of registration policies, configured in settings.yml</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">ATTR_ACCESSIBLE</td>
            <td>=</td>
            <td class="attr-value">[:password, :password_confirmation, :name, :surname, :school_level_id, :location_id, :subject_ids, :purchase_id] + REGISTRATION_POLICIES</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>List of attributes to be made accessible (the list includes private
attributes that don&#39;t correspond to fields, for instance
<code>password_confirmation</code>)</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">PASSWORD_LENGTH_CONSTRAINTS</td>
            <td>=</td>
            <td class="attr-value">{}.tap do |hash|
[:minimum, :maximum].each do |key|
length = SETTINGS[&quot;#{key}_password_length&quot;]
hash[key] = length if length
end
end</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Hash of constraints for the length of the password</p></td>
            </tr>
          
        
      </table>
    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>password</td>
            <td class='attr-desc'><p>The attribute used as a handler for the field
<code>encrypted_password</code></p></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-admin">
            
              <b>admin</b>()
            
            <a href="../classes/User.html#method-c-admin" name="method-c-admin" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-c-admin-label-Description">Description</h3>

<p>It returns an instance of the only super administrator</p>

<h3 id="method-c-admin-label-Returns">Returns</h3>

<p>An object of type <a href="User.html">User</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-admin_source')" id="l_method-c-admin_source">show</a>
                
              </p>
              <div id="method-c-admin_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 146</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">admin</span>
  <span class="ruby-identifier">find_by_email</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;super_admin&#39;</span>]
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-get_full_names">
            
              <b>get_full_names</b>(term)
            
            <a href="../classes/User.html#method-c-get_full_names" name="method-c-get_full_names" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-c-get_full_names-label-Description">Description</h3>

<p>Used in the autocomplete, in the section of the administrator where
it&#39;s possible to send a notification to multiple users
(Admin::MessagesController#filter_users)</p>

<h3 id="method-c-get_full_names-label-Args">Args</h3>
<ul><li>
<p><em>term</em>: the string to be matched agains <code>email</code>,
<code>name</code> and <code>surname</code></p>
</li></ul>

<h3 id="method-c-get_full_names-label-Returns">Returns</h3>

<p>A list of query results where the only field selected is the full name
(<code>name</code> + &#39; &#39; + <code>surname</code>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-get_full_names_source')" id="l_method-c-get_full_names_source">show</a>
                
              </p>
              <div id="method-c-get_full_names_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1132</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">get_full_names</span>(<span class="ruby-identifier">term</span>)
  <span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;email ILIKE ? OR name ILIKE ? OR surname ILIKE ?&#39;</span>, <span class="ruby-node">&quot;%#{term}%&quot;</span>, <span class="ruby-node">&quot;%#{term}%&quot;</span>, <span class="ruby-node">&quot;%#{term}%&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;id, name || &#39; &#39; || surname AS value&quot;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-location_association_class">
            
              <b>location_association_class</b>()
            
            <a href="../classes/User.html#method-c-location_association_class" name="method-c-location_association_class" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-c-location_association_class-label-Description">Description</h3>

<p>Returns the class of the last <a href="Location.html">Location</a> class
(the one that must be attached to a user). The method is defined in this
model and not in <a href="Location.html">Location</a> because it&#39;s
necessary for the association <code>location</code></p>

<h3 id="method-c-location_association_class-label-Returns">Returns</h3>

<p>An object of type Class</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-location_association_class_source')" id="l_method-c-location_association_class_source">show</a>
                
              </p>
              <div id="method-c-location_association_class_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">location_association_class</span>
  <span class="ruby-constant">Location</span><span class="ruby-operator">::</span><span class="ruby-constant">SUBMODELS</span>.<span class="ruby-identifier">last</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-accept_policies">
            
              <b>accept_policies</b>()
            
            <a href="../classes/User.html#method-i-accept_policies" name="method-i-accept_policies" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-accept_policies-label-Description">Description</h3>

<p>It accepts all the policies declared in <code>registration_policies</code>.
Example:  User.new.accept_policies</p>

<h3 id="method-i-accept_policies-label-Returns">Returns</h3>

<p>An enumerator of the policies</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-accept_policies_source')" id="l_method-i-accept_policies_source">show</a>
                
              </p>
              <div id="method-i-accept_policies_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">accept_policies</span>
  <span class="ruby-identifier">registration_policies</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{p}=&quot;</span>, <span class="ruby-string">&#39;1&#39;</span>) }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-admin-3F">
            
              <b>admin?</b>()
            
            <a href="../classes/User.html#method-i-admin-3F" name="method-i-admin-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-admin-3F-label-Description">Description</h3>

<p>It checks if the user is administrator or not (i.e., if the user is allowed
to enter in the administration module, see for instance <a
href="Admin/DashboardController.html">Admin::DashboardController</a>)</p>

<h3 id="method-i-admin-3F-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-admin-3F_source')" id="l_method-i-admin-3F_source">show</a>
                
              </p>
              <div id="method-i-admin-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 158</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">admin?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">super_admin?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;grant_admin_privileges&#39;</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-admin_quick_uploading_cache">
            
              <b>admin_quick_uploading_cache</b>()
            
            <a href="../classes/User.html#method-i-admin_quick_uploading_cache" name="method-i-admin_quick_uploading_cache" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-admin_quick_uploading_cache-label-Description">Description</h3>

<p>Extracts the quick uploadin cache (used in <a
href="Admin/MediaElementsController.html#method-i-new">Admin::MediaElementsController#new</a>)</p>

<h3 id="method-i-admin_quick_uploading_cache-label-Returns">Returns</h3>

<p>A hash with the same keys as <a
href="User.html#method-i-save_in_admin_quick_uploading_cache">#save_in_admin_quick_uploading_cache</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-admin_quick_uploading_cache_source')" id="l_method-i-admin_quick_uploading_cache_source">show</a>
                
              </p>
              <div id="method-i-admin_quick_uploading_cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1234</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">admin_quick_uploading_cache</span>
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>))
  <span class="ruby-identifier">map</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>))
  <span class="ruby-identifier">index</span> = <span class="ruby-identifier">map</span>[<span class="ruby-value">:index</span>]
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-identifier">index</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>][<span class="ruby-value">:name</span>] = <span class="ruby-identifier">i</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-audio_editor_available">
            
              <b>audio_editor_available</b>()
            
            <a href="../classes/User.html#method-i-audio_editor_available" name="method-i-audio_editor_available" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-audio_editor_available-label-Description">Description</h3>

<p>Checks if the <a href="Audio.html">Audio</a> Editor is available (this is
true if there is no <a href="Audio.html">Audio</a> in conversion at the
moment); used in the filters of <a
href="AudioEditorController.html">AudioEditorController</a></p>

<h3 id="method-i-audio_editor_available-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-audio_editor_available_source')" id="l_method-i-audio_editor_available_source">show</a>
                
              </p>
              <div id="method-i-audio_editor_available_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 382</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">audio_editor_available</span>
  <span class="ruby-constant">Audio</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:converted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">all?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">record</span><span class="ruby-operator">|</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">uploaded?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">modified?</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-audio_editor_cache">
            
              <b>audio_editor_cache</b>()
            
            <a href="../classes/User.html#method-i-audio_editor_cache" name="method-i-audio_editor_cache" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-audio_editor_cache-label-Description">Description</h3>

<p>Returns the current <a href="Audio.html">Audio</a> Editor cache for this
user</p>

<h3 id="method-i-audio_editor_cache-label-Returns">Returns</h3>

<p>A hash with parameters (for a sample structure, see <a
href="Media/Audio/Editing/Parameters.html#method-i-convert_parameters">Media::Audio::Editing::Parameters#convert_parameters</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-audio_editor_cache_source')" id="l_method-i-audio_editor_cache_source">show</a>
                
              </p>
              <div id="method-i-audio_editor_cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 247</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">audio_editor_cache</span>
  <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:audio_editor_cache</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-audio_editor_cache-21">
            
              <b>audio_editor_cache!</b>(cache = nil)
            
            <a href="../classes/User.html#method-i-audio_editor_cache-21" name="method-i-audio_editor_cache-21" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-audio_editor_cache-21-label-Description">Description</h3>

<p>Saves the <a href="Audio.html">Audio</a> Editor cache; if the param is
<code>nil</code>, the cache is emptied</p>

<h3 id="method-i-audio_editor_cache-21-label-Args">Args</h3>
<ul><li>
<p><em>cache</em>: the cache to be saved (it must be a hash with the structure
defined in <a
href="Media/Audio/Editing/Parameters.html#method-i-convert_parameters">Media::Audio::Editing::Parameters#convert_parameters</a>;
if <code>nil</code> it empties the cache)</p>
</li></ul>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-audio_editor_cache-21_source')" id="l_method-i-audio_editor_cache-21_source">show</a>
                
              </p>
              <div id="method-i-audio_editor_cache-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">audio_editor_cache!</span>(<span class="ruby-identifier">cache</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">update_attribute</span> <span class="ruby-value">:metadata</span>, <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">marshal_dump</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">audio_editor_cache</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cache</span>))
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-base_location">
            
              <b>base_location</b>()
            
            <a href="../classes/User.html#method-i-base_location" name="method-i-base_location" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-base_location-label-Description">Description</h3>

<p>Method used in the front end that returns the name of the first <a
href="Location.html">Location</a> attached to the user</p>

<h3 id="method-i-base_location-label-Returns">Returns</h3>

<p>A string</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-base_location_source')" id="l_method-i-base_location_source">show</a>
                
              </p>
              <div id="method-i-base_location_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 326</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">base_location</span>
  <span class="ruby-identifier">my_location</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">location</span>
  <span class="ruby-identifier">my_location</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;-&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">my_location</span>.<span class="ruby-identifier">name</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-bookmark">
            
              <b>bookmark</b>(type, target_id)
            
            <a href="../classes/User.html#method-i-bookmark" name="method-i-bookmark" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-bookmark-label-Description">Description</h3>

<p>Used to create a <a href="Bookmark.html">Bookmark</a> on a lesson or a
media element</p>

<h3 id="method-i-bookmark-label-Args">Args</h3>
<ul><li>
<p><em>type</em>: &#39;Lesson&#39; or &#39;MediaElement&#39;</p>
</li><li>
<p><em>target_id</em>: the id of the lesson or element to bookmark</p>
</li></ul>

<h3 id="method-i-bookmark-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-bookmark_source')" id="l_method-i-bookmark_source">show</a>
                
              </p>
              <div id="method-i-bookmark_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 836</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">bookmark</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">target_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-identifier">b</span> = <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bookmarkable_type</span> = <span class="ruby-identifier">type</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bookmarkable_id</span> = <span class="ruby-identifier">target_id</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-create_lesson">
            
              <b>create_lesson</b>(title, description, subject_id, tags)
            
            <a href="../classes/User.html#method-i-create_lesson" name="method-i-create_lesson" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-create_lesson-label-Description">Description</h3>

<p>Creates a lesson belonging to the user (used in <a
href="LessonEditorController.html#method-i-create">LessonEditorController#create</a>)</p>

<h3 id="method-i-create_lesson-label-Args">Args</h3>
<ul><li>
<p><em>title</em>: the title</p>
</li><li>
<p><em>description</em>: the description</p>
</li><li>
<p><em>subject_id</em>: the id of the <a href="Subject.html">Subject</a>
associated to the <a href="Lesson.html">Lesson</a>, chosen among the ones
associated to the user at the moment of the creation</p>
</li><li>
<p><em>tags</em>: tags (in the shape &#39;tag1, tag2, tag3, tag4&#39;)</p>
</li></ul>

<h3 id="method-i-create_lesson-label-Returns">Returns</h3>

<p>If the lesson was correctly created, it returns a new object of type <a
href="Lesson.html">Lesson</a>; otherwise, its errors.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-create_lesson_source')" id="l_method-i-create_lesson_source">show</a>
                
              </p>
              <div id="method-i-create_lesson_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1026</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">create_lesson</span>(<span class="ruby-identifier">title</span>, <span class="ruby-identifier">description</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">tags</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">UsersSubject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">subject_id</span>).<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">lesson</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">subject_id</span>, <span class="ruby-value">:school_level_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">school_level_id</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">copied_not_modified</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tags</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">save_tags</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">valid?</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:subject_id</span>, <span class="ruby-value">:is_not_your_subject</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">errors</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">lesson</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">subject_id</span>, <span class="ruby-value">:school_level_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">school_level_id</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>
  <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">copied_not_modified</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tags</span>
  <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">save_tags</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">save</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">lesson</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">errors</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-destroy_notification_and_reload">
            
              <b>destroy_notification_and_reload</b>(notification_id, offset)
            
            <a href="../classes/User.html#method-i-destroy_notification_and_reload" name="method-i-destroy_notification_and_reload" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-destroy_notification_and_reload-label-Description">Description</h3>

<p>Destroys a <a href="Notification.html">Notification</a> and reloads the
current block of notifications (used in <a
href="NotificationsController.html#method-i-destroy">NotificationsController#destroy</a>)</p>

<h3 id="method-i-destroy_notification_and_reload-label-Args">Args</h3>
<ul><li>
<p><em>notification_id</em>: the id of the notification to be deleted</p>
</li><li>
<p><em>offset</em>: the current offset of the notification block that the user
is visualizing</p>
</li></ul>

<h3 id="method-i-destroy_notification_and_reload-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-destroy_notification_and_reload_source')" id="l_method-i-destroy_notification_and_reload_source">show</a>
                
              </p>
              <div id="method-i-destroy_notification_and_reload_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 930</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">destroy_notification_and_reload</span>(<span class="ruby-identifier">notification_id</span>, <span class="ruby-identifier">offset</span>)
  <span class="ruby-identifier">notification_id</span> = <span class="ruby-number">0</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">notification_id</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">notification_id</span> <span class="ruby-operator">&lt;</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">offset</span> = <span class="ruby-number">0</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">offset</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">offset</span> <span class="ruby-operator">&lt;</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">n</span> = <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">notification_id</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">n</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-identifier">resp_last</span> = <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">resp_offset</span> = <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">count</span>
    <span class="ruby-identifier">resp_last</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> ([<span class="ruby-identifier">resp_offset</span>, <span class="ruby-identifier">resp_offset</span>] <span class="ruby-operator">!=</span> [<span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;notifications_loaded_together&#39;</span>], <span class="ruby-identifier">offset</span>])
    <span class="ruby-identifier">resp</span> = {<span class="ruby-value">:last</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp_last</span>, <span class="ruby-value">:offset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp_offset</span>}
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-destroy_with_dependencies">
            
              <b>destroy_with_dependencies</b>()
            
            <a href="../classes/User.html#method-i-destroy_with_dependencies" name="method-i-destroy_with_dependencies" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-destroy_with_dependencies-label-Description">Description</h3>

<p>Used to destroy a user and remove it from the database: since for safety
reasons there are no database cascade destructions for the associated
relations <a href="Lesson.html">Lesson</a>, <a
href="UsersSubject.html">UsersSubject</a>, <a
href="Bookmark.html">Bookmark</a>, <a
href="Notification.html">Notification</a>, <a href="Like.html">Like</a> and
<a href="Report.html">Report</a>, these are destroyed manually here; for
the table <a href="MailingListGroup.html">MailingListGroup</a>, there is a
cascade destruction; for the table <a
href="MediaElement.html">MediaElement</a>, the method destroys only the
private ones and changes the owner of the public ones (assigned to the
super administrator, extracted by the method <a
href="User.html#method-c-admin">::admin</a>). The only user that can&#39;t
be destroyed with this method is the super administrator (the method checks
this using <a href="User.html#method-i-super_admin-3F">#super_admin?</a>)</p>

<h3 id="method-i-destroy_with_dependencies-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-destroy_with_dependencies_source')" id="l_method-i-destroy_with_dependencies_source">show</a>
                
              </p>
              <div id="method-i-destroy_with_dependencies_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1067</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">destroy_with_dependencies</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">super_admin?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">l</span>.<span class="ruby-identifier">destroy_with_notifications</span>
          <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">UsersSubject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">us</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">us</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Document</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">d</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">me</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">me</span>.<span class="ruby-identifier">is_public</span>
          <span class="ruby-identifier">me</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">admin</span>.<span class="ruby-identifier">id</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">me</span>.<span class="ruby-identifier">save</span>
            <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
            <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">me</span>.<span class="ruby-identifier">destroy</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">b</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">n</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">l</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Report</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidForeignKey</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-dislike">
            
              <b>dislike</b>(lesson_id)
            
            <a href="../classes/User.html#method-i-dislike" name="method-i-dislike" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-dislike-label-Description">Description</h3>

<p>Removes a &#39;I like you&#39; that the user had formerly assigned to a <a
href="Lesson.html">Lesson</a></p>

<h3 id="method-i-dislike-label-Args">Args</h3>
<ul><li>
<p><em>lesson_id</em>: the id of the lesson tha the user doesn&#39;t
appreciate anymore</p>
</li></ul>

<h3 id="method-i-dislike-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-dislike_source')" id="l_method-i-dislike_source">show</a>
                
              </p>
              <div id="method-i-dislike_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 603</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">dislike</span>(<span class="ruby-identifier">lesson_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">lesson_id</span>)
  <span class="ruby-identifier">like</span> = <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson_id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">like</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">like</span>.<span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson_id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-empty_playlist">
            
              <b>empty_playlist</b>()
            
            <a href="../classes/User.html#method-i-empty_playlist" name="method-i-empty_playlist" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-empty_playlist-label-Description">Description</h3>

<p>Sets <code>position</code> = <code>nil</code> for all the elements of type
<a href="VirtualClassroomLesson.html">VirtualClassroomLesson</a> associated
to the user (hence, it removes them from the playlist). Used in <a
href="VirtualClassroomController.html#method-i-empty_playlist">VirtualClassroomController#empty_playlist</a></p>

<h3 id="method-i-empty_playlist-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-empty_playlist_source')" id="l_method-i-empty_playlist_source">show</a>
                
              </p>
              <div id="method-i-empty_playlist_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 863</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">empty_playlist</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;user_id = ? AND position IS NOT NULL&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;position DESC&#39;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vcl</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">vcl</span>.<span class="ruby-identifier">position</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">vcl</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-empty_virtual_classroom">
            
              <b>empty_virtual_classroom</b>()
            
            <a href="../classes/User.html#method-i-empty_virtual_classroom" name="method-i-empty_virtual_classroom" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-empty_virtual_classroom-label-Description">Description</h3>

<p>Deletes all the elements of type <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a> associated to
the user. Used in <a
href="VirtualClassroomController.html#method-i-empty_virtual_classroom">VirtualClassroomController#empty_virtual_classroom</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-empty_virtual_classroom_source')" id="l_method-i-empty_virtual_classroom_source">show</a>
                
              </p>
              <div id="method-i-empty_virtual_classroom_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 849</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">empty_virtual_classroom</span>
  <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vcl</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">vcl</span>.<span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-full_name">
            
              <b>full_name</b>()
            
            <a href="../classes/User.html#method-i-full_name" name="method-i-full_name" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-full_name-label-Description">Description</h3>

<p>Method used in the front end as a shortcut to show the full name of the
user</p>

<h3 id="method-i-full_name-label-Returns">Returns</h3>

<p>A string</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-full_name_source')" id="l_method-i-full_name_source">show</a>
                
              </p>
              <div id="method-i-full_name_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 314</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">full_name</span>
  <span class="ruby-node">&quot;#{self.name} #{self.surname}&quot;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-full_virtual_classroom">
            
              <b>full_virtual_classroom</b>(page, per_page)
            
            <a href="../classes/User.html#method-i-full_virtual_classroom" name="method-i-full_virtual_classroom" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-full_virtual_classroom-label-Description">Description</h3>

<p>Returns the list of lessons in the user&#39;s Virtual Classroom (used in <a
href="VirtualClassroomController.html#method-i-index">VirtualClassroomController#index</a>)</p>

<h3 id="method-i-full_virtual_classroom-label-Args">Args</h3>
<ul><li>
<p><em>page</em>: pagination parameter</p>
</li><li>
<p><em>per_page</em>: pagination parameter</p>
</li></ul>

<h3 id="method-i-full_virtual_classroom-label-Returns">Returns</h3>

<p>A hash with the following keys: * <em>records</em>: the effective content
of the research, an array of object of type <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a> *
<em>pages_amount</em>: an integer, the total number of pages in the
method&#39;s result</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-full_virtual_classroom_source')" id="l_method-i-full_virtual_classroom_source">show</a>
                
              </p>
              <div id="method-i-full_virtual_classroom_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 891</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">full_virtual_classroom</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>)
  <span class="ruby-identifier">page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">per_page</span>
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>, <span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:lesson</span>, {<span class="ruby-value">:lesson</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user</span>}, {<span class="ruby-value">:lesson</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:subject</span>}).<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>)
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:covers</span>] = {}
  <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>].<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:lesson_id</span>), <span class="ruby-value">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;cover&#39;</span>).<span class="ruby-identifier">preload</span>(<span class="ruby-value">:media_elements_slides</span>, {<span class="ruby-value">:media_elements_slides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:media_element</span>}).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cov</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:covers</span>][<span class="ruby-identifier">cov</span>.<span class="ruby-identifier">lesson_id</span>] = <span class="ruby-identifier">cov</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-like">
            
              <b>like</b>(lesson_id)
            
            <a href="../classes/User.html#method-i-like" name="method-i-like" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-like-label-Description">Description</h3>

<p>Saves a &#39;I like you&#39; for a <a href="Lesson.html">Lesson</a></p>

<h3 id="method-i-like-label-Args">Args</h3>
<ul><li>
<p><em>lesson_id</em>: the id of the lesson that the user appreciates</p>
</li></ul>

<h3 id="method-i-like-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-like_source')" id="l_method-i-like_source">show</a>
                
              </p>
              <div id="method-i-like_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 582</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">like</span>(<span class="ruby-identifier">lesson_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">lesson_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson_id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">any?</span>
  <span class="ruby-identifier">l</span> = <span class="ruby-constant">Like</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">l</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">l</span>.<span class="ruby-identifier">lesson_id</span> = <span class="ruby-identifier">lesson_id</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-new_mailing_list_name">
            
              <b>new_mailing_list_name</b>()
            
            <a href="../classes/User.html#method-i-new_mailing_list_name" name="method-i-new_mailing_list_name" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-new_mailing_list_name-label-Description">Description</h3>

<p>Creates a temporary unique new name for a <a
href="MailingListGroup.html">MailingListGroup</a> (used in
MailingListController#create_group)</p>

<h3 id="method-i-new_mailing_list_name-label-Returns">Returns</h3>

<p>A string</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-new_mailing_list_name_source')" id="l_method-i-new_mailing_list_name_source">show</a>
                
              </p>
              <div id="method-i-new_mailing_list_name_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 284</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">new_mailing_list_name</span>
  <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;users.mailing_list.label&#39;</span>, <span class="ruby-value">:number</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-constant">MailingListGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">+</span> <span class="ruby-number">1</span>))
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-notifications_visible_block">
            
              <b>notifications_visible_block</b>(offset, limit)
            
            <a href="../classes/User.html#method-i-notifications_visible_block" name="method-i-notifications_visible_block" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-notifications_visible_block-label-Description">Description</h3>

<p>Gets the first visible block of notifications associated to the user (used
in <a
href="ApplicationController.html#method-i-initialize_layout">ApplicationController#initialize_layout</a>
and <a
href="NotificationsController.html#method-i-get_new_block">NotificationsController#get_new_block</a>)</p>

<h3 id="method-i-notifications_visible_block-label-Returns">Returns</h3>

<p>An array of objects of type <a href="Notification.html">Notification</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-notifications_visible_block_source')" id="l_method-i-notifications_visible_block_source">show</a>
                
              </p>
              <div id="method-i-notifications_visible_block_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 954</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">notifications_visible_block</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>)
  <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-number_notifications_not_seen">
            
              <b>number_notifications_not_seen</b>()
            
            <a href="../classes/User.html#method-i-number_notifications_not_seen" name="method-i-number_notifications_not_seen" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-number_notifications_not_seen-label-Description">Description</h3>

<p>Gets the total number of notifications not seen by the user (used in <a
href="ApplicationController.html#method-i-initialize_layout">ApplicationController#initialize_layout</a>
and <a
href="NotificationsController.html#method-i-seen">NotificationsController#seen</a>)</p>

<h3 id="method-i-number_notifications_not_seen-label-Returns">Returns</h3>

<p>An integer</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-number_notifications_not_seen_source')" id="l_method-i-number_notifications_not_seen_source">show</a>
                
              </p>
              <div id="method-i-number_notifications_not_seen_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 966</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">number_notifications_not_seen</span>
  <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:seen</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-own_documents">
            
              <b>own_documents</b>(page, per_page, order_by=SearchOrders::CREATED_AT, word=nil, from_gallery=false)
            
            <a href="../classes/User.html#method-i-own_documents" name="method-i-own_documents" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-own_documents-label-Description">Description</h3>

<p>Extracts the documents present in the user&#39;s personal section (see <a
href="DocumentsController.html#method-i-index">DocumentsController#index</a>).</p>

<h3 id="method-i-own_documents-label-Args">Args</h3>
<ul><li>
<p><em>page</em>: pagination parameter</p>
</li><li>
<p><em>per_page</em>: pagination parameter</p>
</li><li>
<p><em>order_by</em>: order, from <a href="SearchOrders.html">SearchOrders</a></p>
</li><li>
<p><em>word</em>: keyword, if any</p>
</li></ul>

<h3 id="method-i-own_documents-label-Returns">Returns</h3>

<p>A hash with the following keys: * <em>records</em>: the effective content
of the research, an array of object of type <a
href="Document.html">Document</a> * <em>pages_amount</em>: an integer, the
total number of pages in the method&#39;s result</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-own_documents_source')" id="l_method-i-own_documents_source">show</a>
                
              </p>
              <div id="method-i-own_documents_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 745</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">own_documents</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">order_by</span>=<span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">CREATED_AT</span>, <span class="ruby-identifier">word</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">from_gallery</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">per_page</span>
  <span class="ruby-identifier">word</span> = <span class="ruby-identifier">word</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">word</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">CREATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;created_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;title ASC, created_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;documents.*&#39;</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-node">&quot;#{select}, (SELECT COUNT(*) FROM documents_slides INNER JOIN slides ON slides.id = documents_slides.slide_id INNER JOIN lessons ON lessons.id = slides.lesson_id WHERE documents_slides.document_id = documents.id AND lessons.user_id = documents.user_id) AS instances&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">from_gallery</span>
  <span class="ruby-identifier">relation</span> = <span class="ruby-constant">Document</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;user_id = ? AND title ILIKE ?&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-node">&quot;%#{word}%&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>)
  <span class="ruby-keyword">end</span>
  {
    <span class="ruby-value">:records</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>),
    <span class="ruby-value">:pages_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">relation</span>.<span class="ruby-identifier">count</span>, <span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">ceil</span>
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-own_lessons">
            
              <b>own_lessons</b>(page, per_page, filter=Filters::ALL_LESSONS, from_virtual_classroom=false)
            
            <a href="../classes/User.html#method-i-own_lessons" name="method-i-own_lessons" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-own_lessons-label-Description">Description</h3>

<p>Extracts the lessons present in the user&#39;s personal section (see <a
href="LessonsController.html#method-i-index">LessonsController#index</a>):
the method uses the scope <code>of</code> defined in <a
href="Lesson.html">Lesson</a>, and applies filters on it. Each lesson has
its status set with <a
href="Lesson.html#method-i-set_status">Lesson#set_status</a>.</p>

<h3 id="method-i-own_lessons-label-Args">Args</h3>
<ul><li>
<p><em>page</em>: pagination parameter</p>
</li><li>
<p><em>per_page</em>: pagination parameter</p>
</li><li>
<p><em>filter</em>: an additional filter defined in <a
href="Filters.html">Filters</a></p>
</li></ul>

<h3 id="method-i-own_lessons-label-Returns">Returns</h3>

<p>A hash with the following keys: * <em>records</em>: the effective content
of the research, an array of object of type <a
href="Lesson.html">Lesson</a> * <em>pages_amount</em>: an integer, the
total number of pages in the method&#39;s result</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-own_lessons_source')" id="l_method-i-own_lessons_source">show</a>
                
              </p>
              <div id="method-i-own_lessons_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 666</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">own_lessons</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>, <span class="ruby-identifier">from_virtual_classroom</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">per_page</span>
  <span class="ruby-identifier">relation1</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">from_virtual_classroom</span>
    <span class="ruby-identifier">relation1</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:subject</span>, <span class="ruby-value">:user</span>).<span class="ruby-identifier">select</span>(<span class="ruby-node">&quot;lessons.*,
      (SELECT COUNT (*) FROM virtual_classroom_lessons WHERE virtual_classroom_lessons.lesson_id = lessons.id AND virtual_classroom_lessons.user_id = #{self.class.connection.quote self.id.to_i}) AS virtuals_count
    &quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">relation1</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:subject</span>, <span class="ruby-value">:user</span>, <span class="ruby-value">:school_level</span>, {<span class="ruby-value">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:location</span>}).<span class="ruby-identifier">select</span>(<span class="ruby-node">&quot;
      lessons.*,
      (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id AND bookmarks.user_id = #{self.class.connection.quote self.id.to_i}) AS bookmarks_count,
      (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id) AS all_bookmarks_count,
      (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id AND bookmarks.user_id != #{self.class.connection.quote self.id} AND bookmarks.created_at &lt; lessons.updated_at) AS notification_bookmarks,
      (SELECT COUNT (*) FROM virtual_classroom_lessons WHERE virtual_classroom_lessons.lesson_id = lessons.id AND virtual_classroom_lessons.user_id = #{self.class.connection.quote self.id.to_i}) AS virtuals_count,
      (SELECT COUNT (*) FROM likes WHERE likes.lesson_id = lessons.id AND likes.user_id = #{self.class.connection.quote self.id.to_i}) AS likes_count,
      (SELECT COUNT (*) FROM likes WHERE likes.lesson_id = lessons.id) AS likes_general_count
    &quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">relation2</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PRIVATE</span>
      <span class="ruby-identifier">relation1</span> = <span class="ruby-identifier">relation1</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">is_public</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
      <span class="ruby-identifier">relation2</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">is_public</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
      <span class="ruby-identifier">relation1</span> = <span class="ruby-identifier">relation1</span>.<span class="ruby-identifier">of</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_public</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
      <span class="ruby-identifier">relation2</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">of</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_public</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">LINKED</span>
      <span class="ruby-identifier">relation1</span> = <span class="ruby-identifier">relation1</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:bookmarks</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">bookmarks</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> }).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;bookmarks.created_at DESC&#39;</span>)
      <span class="ruby-identifier">relation2</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:bookmarks</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">bookmarks</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> }).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;bookmarks.created_at DESC&#39;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ONLY_MINE</span>
      <span class="ruby-identifier">relation1</span> = <span class="ruby-identifier">relation1</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
      <span class="ruby-identifier">relation2</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">COPIED</span>
      <span class="ruby-identifier">relation1</span> = <span class="ruby-identifier">relation1</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:copied_not_modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
      <span class="ruby-identifier">relation2</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:copied_not_modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>
      <span class="ruby-identifier">relation1</span> = <span class="ruby-identifier">relation1</span>.<span class="ruby-identifier">of</span>(<span class="ruby-keyword">self</span>)
      <span class="ruby-identifier">relation2</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">of</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&#39;filter not supported&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">pages_amount</span> = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">relation2</span>.<span class="ruby-identifier">count</span>, <span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-identifier">relation1</span> = <span class="ruby-identifier">relation1</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>)
  <span class="ruby-identifier">relation2</span> = <span class="ruby-identifier">relation2</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>)
  <span class="ruby-identifier">covers</span> = {}
  <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">relation2</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:id</span>), <span class="ruby-value">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;cover&#39;</span>).<span class="ruby-identifier">preload</span>(<span class="ruby-value">:media_elements_slides</span>, {<span class="ruby-value">:media_elements_slides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:media_element</span>}).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cov</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">covers</span>[<span class="ruby-identifier">cov</span>.<span class="ruby-identifier">lesson_id</span>] = <span class="ruby-identifier">cov</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">from_virtual_classroom</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">relation1</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">resp</span> = []
    <span class="ruby-identifier">relation1</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lesson</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, {<span class="ruby-value">:bookmarked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bookmarks_count</span>, <span class="ruby-value">:in_vc</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:virtuals_count</span>, <span class="ruby-value">:liked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:likes_count</span>}
      <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lesson</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  {<span class="ruby-value">:records</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp</span>, <span class="ruby-value">:pages_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pages_amount</span>, <span class="ruby-value">:covers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">covers</span>}
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-own_mailing_list_groups">
            
              <b>own_mailing_list_groups</b>()
            
            <a href="../classes/User.html#method-i-own_mailing_list_groups" name="method-i-own_mailing_list_groups" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-own_mailing_list_groups-label-Description">Description</h3>

<p>Alternative to the association <code>mailing_list_groups</code>, that sorts
the groups by name</p>

<h3 id="method-i-own_mailing_list_groups-label-Returns">Returns</h3>

<p>An array of objects of kind <a
href="MailingListGroup.html">MailingListGroup</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-own_mailing_list_groups_source')" id="l_method-i-own_mailing_list_groups_source">show</a>
                
              </p>
              <div id="method-i-own_mailing_list_groups_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">own_mailing_list_groups</span>
  <span class="ruby-constant">MailingListGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-own_media_elements">
            
              <b>own_media_elements</b>(page, per_page, filter=Filters::ALL_MEDIA_ELEMENTS, from_gallery=false)
            
            <a href="../classes/User.html#method-i-own_media_elements" name="method-i-own_media_elements" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-own_media_elements-label-Description">Description</h3>

<p>Extracts the elements present in the user&#39;s personal section (see <a
href="MediaElementsController.html#method-i-index">MediaElementsController#index</a>,
and <a href="GalleriesController.html">GalleriesController</a>): the method
uses the scope <code>of</code> defined in <a
href="MediaElement.html">MediaElement</a>, and applies filters on it. Each
element has its status set with <a
href="MediaElement.html#method-i-set_status">MediaElement#set_status</a>.</p>

<h3 id="method-i-own_media_elements-label-Args">Args</h3>
<ul><li>
<p><em>page</em>: pagination parameter</p>
</li><li>
<p><em>per_page</em>: pagination parameter</p>
</li><li>
<p><em>filter</em>: an additional filter defined in <a
href="Filters.html">Filters</a></p>
</li></ul>

<h3 id="method-i-own_media_elements-label-Returns">Returns</h3>

<p>A hash with the following keys: * <em>records</em>: the effective content
of the research, an array of object of type <a
href="MediaElement.html">MediaElement</a> * <em>pages_amount</em>: an
integer, the total number of pages in the method&#39;s result</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-own_media_elements_source')" id="l_method-i-own_media_elements_source">show</a>
                
              </p>
              <div id="method-i-own_media_elements_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 627</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">own_media_elements</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_MEDIA_ELEMENTS</span>, <span class="ruby-identifier">from_gallery</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">per_page</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;media_elements.*&#39;</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-node">&quot;#{select}, (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;MediaElement&#39;} AND bookmarks.bookmarkable_id = media_elements.id AND bookmarks.user_id = #{self.class.connection.quote self.id.to_i}) AS bookmarks_count, (SELECT COUNT(*) FROM media_elements_slides WHERE (media_elements_slides.media_element_id = media_elements.id)) AS instances&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">from_gallery</span>
  <span class="ruby-identifier">relation</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">of</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">if</span> [<span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">VIDEO</span>, <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">AUDIO</span>, <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGE</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;sti_type = ?&#39;</span>, <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">capitalize</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">pages_amount</span> = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">relation</span>.<span class="ruby-identifier">count</span>, <span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">from_gallery</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">me</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">me</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, {<span class="ruby-value">:bookmarked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bookmarks_count</span>}
      <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">me</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  {<span class="ruby-value">:records</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp</span>, <span class="ruby-value">:pages_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pages_amount</span>}
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-parent_locations">
            
              <b>parent_locations</b>()
            
            <a href="../classes/User.html#method-i-parent_locations" name="method-i-parent_locations" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-parent_locations-label-Description">Description</h3>

<p>Used in the front end, it returns a resume of all the parents locations of
the user</p>

<h3 id="method-i-parent_locations-label-Returns">Returns</h3>

<p>A string</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-parent_locations_source')" id="l_method-i-parent_locations_source">show</a>
                
              </p>
              <div id="method-i-parent_locations_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 339</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">parent_locations</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">locations</span> = []
  <span class="ruby-identifier">first</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">current_location</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">location</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;-&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_location</span>.<span class="ruby-identifier">nil?</span>
  (<span class="ruby-number">0</span><span class="ruby-operator">...</span><span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;location_types&#39;</span>].<span class="ruby-identifier">length</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_location</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;location_types&#39;</span>].<span class="ruby-identifier">last</span>
      <span class="ruby-identifier">locations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">current_location</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">current_location</span> = <span class="ruby-identifier">current_location</span>.<span class="ruby-identifier">parent</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">locations</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">first</span>
      <span class="ruby-identifier">resp</span> = <span class="ruby-node">&quot;#{l.name}&quot;</span>
      <span class="ruby-identifier">first</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">resp</span> = <span class="ruby-node">&quot;#{resp} - #{l.name}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-playlist">
            
              <b>playlist</b>(from_viewer=false)
            
            <a href="../classes/User.html#method-i-playlist" name="method-i-playlist" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-playlist-label-Description">Description</h3>

<p>Returns the playlist of the user&#39;s Virtual Classroom</p>

<h3 id="method-i-playlist-label-Args">Args</h3>
<ul><li>
<p><em>from_viewer</em>: true if the method needs to preload users together
with the lesson</p>
</li></ul>

<h3 id="method-i-playlist-label-Returns">Returns</h3>

<p>An array of objects of type <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-playlist_source')" id="l_method-i-playlist_source">show</a>
                
              </p>
              <div id="method-i-playlist_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 994</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">playlist</span>(<span class="ruby-identifier">from_viewer</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">from_viewer</span> <span class="ruby-operator">?</span> <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:lesson</span>, {<span class="ruby-value">:lesson</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:subject</span>}, {<span class="ruby-value">:lesson</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user</span>}) <span class="ruby-operator">:</span> <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:lesson</span>, {<span class="ruby-value">:lesson</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:subject</span>})
  <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;user_id = ? AND position IS NOT NULL&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:position</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-playlist_for_viewer">
            
              <b>playlist_for_viewer</b>()
            
            <a href="../classes/User.html#method-i-playlist_for_viewer" name="method-i-playlist_for_viewer" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-playlist_for_viewer-label-Description">Description</h3>

<p>Gets the playlist for the <a href="Lesson.html">Lesson</a> Viewer (used in
<a
href="LessonViewerController.html#method-i-playlist">LessonViewerController#playlist</a>)</p>

<h3 id="method-i-playlist_for_viewer-label-Returns">Returns</h3>

<p>An array of ordered objects of type <a href="Slide.html">Slide</a> (they
correspond to the slides of the lessons in the playlist)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-playlist_for_viewer_source')" id="l_method-i-playlist_for_viewer_source">show</a>
                
              </p>
              <div id="method-i-playlist_for_viewer_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1007</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">playlist_for_viewer</span>
  <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:documents_slides</span>, {<span class="ruby-value">:documents_slides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:document</span>}, <span class="ruby-value">:lesson</span>, {<span class="ruby-value">:lesson</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user</span>}, {<span class="ruby-value">:lesson</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:subject</span>}, <span class="ruby-value">:media_elements_slides</span>, {<span class="ruby-value">:media_elements_slides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:media_element</span>}).<span class="ruby-identifier">joins</span>(<span class="ruby-value">:lesson</span>, {<span class="ruby-value">:lesson</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:virtual_classroom_lessons</span>}).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;virtual_classroom_lessons.user_id = ? AND virtual_classroom_lessons.lesson_id = lessons.id AND virtual_classroom_lessons.position IS NOT NULL&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;virtual_classroom_lessons.position ASC, slides.position ASC&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-playlist_full-3F">
            
              <b>playlist_full?</b>()
            
            <a href="../classes/User.html#method-i-playlist_full-3F" name="method-i-playlist_full-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-playlist_full-3F-label-Description">Description</h3>

<p>Checks if the playlist is full in the user&#39;s Virtual Classroom</p>

<h3 id="method-i-playlist_full-3F-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-playlist_full-3F_source')" id="l_method-i-playlist_full-3F_source">show</a>
                
              </p>
              <div id="method-i-playlist_full-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 978</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">playlist_full?</span>
  <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;user_id = ? AND position IS NOT NULL&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;lessons_in_playlist&#39;</span>]
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-registration_policies">
            
              <b>registration_policies</b>()
            
            <a href="../classes/User.html#method-i-registration_policies" name="method-i-registration_policies" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-registration_policies-label-Description">Description</h3>

<p>Manual attr_reader for the constant <a
href="User.html#REGISTRATION_POLICIES">REGISTRATION_POLICIES</a>, that
contains all the policies as configured in settings.yml</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-registration_policies_source')" id="l_method-i-registration_policies_source">show</a>
                
              </p>
              <div id="method-i-registration_policies_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 292</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">registration_policies</span>
  <span class="ruby-constant">REGISTRATION_POLICIES</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-remove_from_admin_quick_uploading_cache">
            
              <b>remove_from_admin_quick_uploading_cache</b>(name)
            
            <a href="../classes/User.html#method-i-remove_from_admin_quick_uploading_cache" name="method-i-remove_from_admin_quick_uploading_cache" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-remove_from_admin_quick_uploading_cache-label-Description">Description</h3>

<p>Removes a file from the list of multiple uploading of an element (used in
<a
href="Admin/MediaElementsController.html#method-i-quick_upload_delete">Admin::MediaElementsController#quick_upload_delete</a>
and <a
href="Admin/MediaElementsController.html#method-i-create">Admin::MediaElementsController#create</a>).</p>

<h3 id="method-i-remove_from_admin_quick_uploading_cache-label-Args">Args</h3>
<ul><li>
<p><em>name</em>: the random key generated in <a
href="User.html#method-i-save_in_admin_quick_uploading_cache">#save_in_admin_quick_uploading_cache</a>,
used as a key in the hash of files in uploading</p>
</li></ul>

<h3 id="method-i-remove_from_admin_quick_uploading_cache-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-remove_from_admin_quick_uploading_cache_source')" id="l_method-i-remove_from_admin_quick_uploading_cache_source">show</a>
                
              </p>
              <div id="method-i-remove_from_admin_quick_uploading_cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1148</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">remove_from_admin_quick_uploading_cache</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>))
  <span class="ruby-identifier">map</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>)))
  <span class="ruby-identifier">item</span> = <span class="ruby-identifier">map</span>[<span class="ruby-identifier">name</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/#{name}#{item[:ext]}&quot;</span>)
  <span class="ruby-identifier">map</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">name</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:index</span>].<span class="ruby-identifier">delete</span> <span class="ruby-identifier">name</span>
  <span class="ruby-identifier">yaml</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>), <span class="ruby-string">&#39;w&#39;</span>)
  <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_yaml</span>
  <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-report_lesson">
            
              <b>report_lesson</b>(lesson_id, msg)
            
            <a href="../classes/User.html#method-i-report_lesson" name="method-i-report_lesson" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-report_lesson-label-Description">Description</h3>

<p>Sends a <a href="Report.html">Report</a> for a <a
href="Lesson.html">Lesson</a></p>

<h3 id="method-i-report_lesson-label-Args">Args</h3>
<ul><li>
<p><em>lesson_id</em>: id of the lesson to be reported</p>
</li><li>
<p><em>msg</em>: the attached message</p>
</li></ul>

<h3 id="method-i-report_lesson-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-report_lesson_source')" id="l_method-i-report_lesson_source">show</a>
                
              </p>
              <div id="method-i-report_lesson_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 513</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">report_lesson</span>(<span class="ruby-identifier">lesson_id</span>, <span class="ruby-identifier">msg</span>)
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_reporting</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Report</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">reportable_type</span> = <span class="ruby-string">&#39;Lesson&#39;</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">reportable_id</span> = <span class="ruby-identifier">lesson_id</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">msg</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">r</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">added?</span> <span class="ruby-value">:reportable_id</span>, <span class="ruby-value">:taken</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:lesson_already_reported</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_reporting</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-report_media_element">
            
              <b>report_media_element</b>(media_element_id, msg)
            
            <a href="../classes/User.html#method-i-report_media_element" name="method-i-report_media_element" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-report_media_element-label-Description">Description</h3>

<p>Sends a <a href="Report.html">Report</a> for a <a
href="MediaElement.html">MediaElement</a></p>

<h3 id="method-i-report_media_element-label-Args">Args</h3>
<ul><li>
<p><em>media_element_id</em>: id of the element to be reported</p>
</li><li>
<p><em>msg</em>: the attached message</p>
</li></ul>

<h3 id="method-i-report_media_element-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-report_media_element_source')" id="l_method-i-report_media_element_source">show</a>
                
              </p>
              <div id="method-i-report_media_element_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 548</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">report_media_element</span>(<span class="ruby-identifier">media_element_id</span>, <span class="ruby-identifier">msg</span>)
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_reporting</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Report</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">reportable_type</span> = <span class="ruby-string">&#39;MediaElement&#39;</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">reportable_id</span> = <span class="ruby-identifier">media_element_id</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">msg</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">r</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">added?</span> <span class="ruby-value">:reportable_id</span>, <span class="ruby-value">:taken</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:media_element_already_reported</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_reporting</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-save_in_admin_quick_uploading_cache">
            
              <b>save_in_admin_quick_uploading_cache</b>(file, title=nil, description=nil, tags=nil)
            
            <a href="../classes/User.html#method-i-save_in_admin_quick_uploading_cache" name="method-i-save_in_admin_quick_uploading_cache" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-save_in_admin_quick_uploading_cache-label-Description">Description</h3>

<p>Saves a file in the uploading cache (used in <a
href="Admin/MediaElementsController.html#method-i-quick_upload">Admin::MediaElementsController#quick_upload</a>):
the method creates a random name for the file, that will be used as its
unique key in the hash</p>

<h3 id="method-i-save_in_admin_quick_uploading_cache-label-Args">Args</h3>
<ul><li>
<p><em>file</em>: the attached file</p>
</li><li>
<p><em>title</em>: the title (if <code>nil</code>, it doesn&#39;t specify any
title and it&#39;ll need to be inserted at the time of the creation)</p>
</li><li>
<p><em>description</em>: the description (if <code>nil</code>, it doesn&#39;t
specify any description and it&#39;ll need to be inserted at the time of
the creation)</p>
</li><li>
<p><em>tags</em>: the tags in shape &#39;tag1, tag2, tag3, tag4&#39; (if
<code>nil</code>, it doesn&#39;t specify any tags and tags will need to be
inserted at the time of the creation)</p>
</li></ul>

<h3 id="method-i-save_in_admin_quick_uploading_cache-label-Returns">Returns</h3>

<p>A hash with the following keys * <em>name</em>: the randomly extracted key
* <em>ext</em>: the extension extracted through <a
href="MediaElement.html#method-i-new_with_sti_type_inferring">MediaElement#new_with_sti_type_inferring</a>
* <em>type</em>: the type in [&#39;audio&#39;, &#39;image&#39;,
&#39;video&#39;] * <em>title</em>: the title * <em>description</em>: the
description * <em>tags</em>: the tags in shape &#39;tag1, tag2, tag3,
tag4&#39; * <em>original_name</em>: the original name with which the file
was uploaded</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-save_in_admin_quick_uploading_cache_source')" id="l_method-i-save_in_admin_quick_uploading_cache_source">show</a>
                
              </p>
              <div id="method-i-save_in_admin_quick_uploading_cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1184</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">save_in_admin_quick_uploading_cache</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">title</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">description</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">tags</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">filetype</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">filetype</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filetype</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;public/admin&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;public/admin&#39;</span>))
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}&quot;</span>))
  <span class="ruby-identifier">extension</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>
  <span class="ruby-identifier">map</span> = {}
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>))
    <span class="ruby-identifier">map</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>)))
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_r</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}&quot;</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;a#{SecureRandom.urlsafe_base64(15)}&quot;</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-value">:&quot;#{name}&quot;</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;a#{SecureRandom.urlsafe_base64(15)}&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-value">:index</span>
    <span class="ruby-identifier">map</span>[<span class="ruby-value">:index</span>].<span class="ruby-identifier">unshift</span> <span class="ruby-value">:&quot;#{name}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">map</span>[<span class="ruby-value">:index</span>] = [<span class="ruby-value">:&quot;#{name}&quot;</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>] = {<span class="ruby-value">:ext</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">extension</span>, <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filetype</span>}
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>][<span class="ruby-value">:original_name</span>] = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>][<span class="ruby-value">:title</span>] = <span class="ruby-identifier">title</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>][<span class="ruby-value">:description</span>] = <span class="ruby-identifier">description</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>][<span class="ruby-value">:tags</span>] = <span class="ruby-identifier">tags</span>
  <span class="ruby-identifier">yaml</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>), <span class="ruby-string">&#39;w&#39;</span>)
  <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_yaml</span>
  <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">path</span>, <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/#{name}#{extension}&quot;</span>)
  {
    <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:&quot;#{name}&quot;</span>,
    <span class="ruby-value">:ext</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">extension</span>,
    <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filetype</span>,
    <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>,
    <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>,
    <span class="ruby-value">:tags</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tags</span>,
    <span class="ruby-value">:original_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-search_lessons">
            
              <b>search_lessons</b>(word, page, for_page, order=nil, filter=nil, subject_id=nil, only_tags=nil, school_level_id=nil)
            
            <a href="../classes/User.html#method-i-search_lessons" name="method-i-search_lessons" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-search_lessons-label-Description">Description</h3>

<p>Global method used to search for lessons (see <a
href="SearchController.html#method-i-index">SearchController#index</a>).
Each lesson has its status set with <a
href="Lesson.html#method-i-set_status">Lesson#set_status</a>. *
<em>first</em>, it checks the correctness of all the parameters received; *
<em>then</em>, if <code>word</code> is blank, it calls just <a
href="User.html#method-i-search_lessons_without_tag">#search_lessons_without_tag</a>,
that search using the other parameters inserted by the user *
<em>otherwise</em>, it checks if the word is a Fixnum (it represents the id
of a specific <a href="Tag.html">Tag</a>) or a String (it represents a word
to be matched against the list of registered tags)  * if <code>word</code>
is a Fixnum, the method just calls <a
href="User.html#method-i-search_lessons_with_tag">#search_lessons_with_tag</a>,
which returns only the lessons associated to that particular <a
href="Tag.html">Tag</a> (of course, filtered by the other parameters)  * if
<code>word</code> is a String, the method calls <a
href="User.html#method-i-search_lessons_with_tag">#search_lessons_with_tag</a>
(that returns the lessons found) and <a
href="User.html#method-i-get_tags_associated_to_lesson_search">#get_tags_associated_to_lesson_search</a>
(that returns the list of tags associated to the search) * there is also
the available option <code>only_tags</code>: if this option is used with a
<code>word</code> of type String, the method calls only <a
href="User.html#method-i-get_tags_associated_to_lesson_search">#get_tags_associated_to_lesson_search</a>
(this option is typically used when the user is filtering a previous search
by a specific Tag: in this case, calling only the method with
<code>word</code> = Fixnum, there would be no way to know the previous list
of tags, hence in the controller the method is called again with
<code>word</code> = String and with <code>only_tags</code> = true)</p>

<h3 id="method-i-search_lessons-label-Args">Args</h3>
<ul><li>
<p><em>word</em>: the search parameter. It can be:</p>
</li><li>
<p><code>blank</code> if you need only to search by filters</p>
</li><li>
<p><code>integer</code> if you want to filter by a specific tag</p>
</li><li>
<p><code>string</code> if you want to match a keyword against the list of tags
in the database</p>
</li><li>
<p><em>page</em>: pagination parameter</p>
</li><li>
<p><em>for_page</em>: pagination parameter</p>
</li><li>
<p><em>order</em>: one of the keywords defined in <a
href="SearchOrders.html">SearchOrders</a></p>
</li><li>
<p><em>filter</em>: one of the keywords defined in <a
href="Filters.html">Filters</a></p>
</li><li>
<p><em>subject_id</em>: the id of a <a href="Subject.html">Subject</a>, this
extends the filter to lessons associated to that subject</p>
</li><li>
<p><em>school_level_id</em>: the school level of the lesson</p>
</li><li>
<p><em>only_tags</em>: optional boolean, if used with a <code>word</code> of
kind String returns only the list of tags associated to the search</p>
</li></ul>

<h3 id="method-i-search_lessons-label-Returns">Returns</h3>

<p>A hash with the following keys: * <em>records</em>: the effective content
of the research, an array of object of type <a
href="Lesson.html">Lesson</a> * <em>records_amount</em>: an integer, the
total number of lessons found * <em>pages_amount</em>: an integer, the
total number of pages in the search result * <em>tags</em>: if required, an
array of objects of type <a href="Tag.html">Tag</a>. This is the list of
the first 20 tags associated to at least a lesson in the search result,
ordered by numbers of occurrences among the search results (i.e. order of
relevance)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-search_lessons_source')" id="l_method-i-search_lessons_source">show</a>
                
              </p>
              <div id="method-i-search_lessons_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 473</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">search_lessons</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">page</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">order</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">subject_id</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">only_tags</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">school_level_id</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">only_tags</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_tags</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">subject_id</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>[<span class="ruby-constant">NilClass</span>, <span class="ruby-constant">Fixnum</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">class</span>)
  <span class="ruby-identifier">school_level_id</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>[<span class="ruby-constant">NilClass</span>, <span class="ruby-constant">Fixnum</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">school_level_id</span>.<span class="ruby-identifier">class</span>)
  <span class="ruby-identifier">filter</span> = <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">LESSONS_SEARCH_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">order</span> = <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">LESSONS_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">order</span>)
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">for_page</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">search_lessons_without_tag</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order</span>, <span class="ruby-identifier">school_level_id</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span>
      <span class="ruby-identifier">word</span> = <span class="ruby-identifier">word</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_tags</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">get_tags_associated_to_lesson_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">school_level_id</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">search_lessons_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order</span>, <span class="ruby-identifier">school_level_id</span>)
        <span class="ruby-identifier">resp</span>[<span class="ruby-value">:tags</span>] = <span class="ruby-identifier">get_tags_associated_to_lesson_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">school_level_id</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">search_lessons_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order</span>, <span class="ruby-identifier">school_level_id</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-search_media_elements">
            
              <b>search_media_elements</b>(word, page, for_page, order=nil, filter=nil, only_tags=nil)
            
            <a href="../classes/User.html#method-i-search_media_elements" name="method-i-search_media_elements" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-search_media_elements-label-Description">Description</h3>

<p>Global method used to search for elements (see <a
href="SearchController.html#method-i-index">SearchController#index</a>).
Each element has its status set with <a
href="MediaElement.html#method-i-set_status">MediaElement#set_status</a>. *
<em>first</em>, it checks the correctness of all the parameters received; *
<em>then</em>, if <code>word</code> is blank, it calls just <a
href="User.html#method-i-search_media_elements_without_tag">#search_media_elements_without_tag</a>,
that search using the other parameters inserted by the user *
<em>otherwise</em>, it checks if the word is a Fixnum (it represents the id
of a specific <a href="Tag.html">Tag</a>) or a String (it represents a word
to be matched against the list of registered tags)  * if <code>word</code>
is a Fixnum, the method just calls <a
href="User.html#method-i-search_media_elements_with_tag">#search_media_elements_with_tag</a>,
which returns only the elements associated to that particular <a
href="Tag.html">Tag</a> (of course, filtered by the other parameters)  * if
<code>word</code> is a String, the method calls <a
href="User.html#method-i-search_media_elements_with_tag">#search_media_elements_with_tag</a>
(that returns the media elements found) and <a
href="User.html#method-i-get_tags_associated_to_media_element_search">#get_tags_associated_to_media_element_search</a>
(that returns the list of tags associated to the search) * there is also
the available option <code>only_tags</code>: if this option is used with a
<code>word</code> of type String, the method calls only <a
href="User.html#method-i-get_tags_associated_to_media_element_search">#get_tags_associated_to_media_element_search</a>
(this option is typically used when the user is filtering a previous search
by a specific Tag: in this case, calling only the method with
<code>word</code> = Fixnum, there would be no way to know the previous list
of tags, hence in the controller the method is called again with
<code>word</code> = String and with <code>only_tags</code> = true)</p>

<h3 id="method-i-search_media_elements-label-Args">Args</h3>
<ul><li>
<p><em>word</em>: the search parameter. It can be:</p>
</li><li>
<p><code>blank</code> if you need only to search by filters</p>
</li><li>
<p><code>integer</code> if you want to filter by a specific tag</p>
</li><li>
<p><code>string</code> if you want to match a keyword against the list of tags
in the database</p>
</li><li>
<p><em>page</em>: pagination parameter</p>
</li><li>
<p><em>for_page</em>: pagination parameter</p>
</li><li>
<p><em>order</em>: one of the keywords defined in <a
href="SearchOrders.html">SearchOrders</a></p>
</li><li>
<p><em>filter</em>: one of the keywords defined in <a
href="Filters.html">Filters</a></p>
</li><li>
<p><em>only_tags</em>: optional boolean, if used with a <code>word</code> of
kind String returns only the list of tags associated to the search</p>
</li></ul>

<h3 id="method-i-search_media_elements-label-Returns">Returns</h3>

<p>A hash with the following keys: * <em>records</em>: the effective content
of the research, an array of object of type <a
href="MediaElement.html">MediaElement</a> * <em>records_amount</em>: an
integer, the total number of elements found * <em>pages_amount</em>: an
integer, the total number of pages in the search result * <em>tags</em>: if
required, an array of objects of type <a href="Tag.html">Tag</a>. This is
the list of the first 20 tags associated to at least an element in the
search result, ordered by numbers of occurrences among the search results
(i.e. order of relevance)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-search_media_elements_source')" id="l_method-i-search_media_elements_source">show</a>
                
              </p>
              <div id="method-i-search_media_elements_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 416</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">search_media_elements</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">page</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">order</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">only_tags</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">only_tags</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_tags</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">filter</span> = <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_MEDIA_ELEMENTS</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">MEDIA_ELEMENTS_SEARCH_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">order</span> = <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">MEDIA_ELEMENTS_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">order</span>)
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">for_page</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">search_media_elements_without_tag</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span>
      <span class="ruby-identifier">word</span> = <span class="ruby-identifier">word</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_tags</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">get_tags_associated_to_media_element_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">search_media_elements_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order</span>)
        <span class="ruby-identifier">resp</span>[<span class="ruby-value">:tags</span>] = <span class="ruby-identifier">get_tags_associated_to_media_element_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">search_media_elements_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-subject_ids-3D">
            
              <b>subject_ids=</b>(subject_ids)
            
            <a href="../classes/User.html#method-i-subject_ids-3D" name="method-i-subject_ids-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-subject_ids-3D-label-Description">Description</h3>

<p>Sets the subjects associated to this user (see <a
href="UsersSubject.html">UsersSubject</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-subject_ids-3D_source')" id="l_method-i-subject_ids-3D_source">show</a>
                
              </p>
              <div id="method-i-subject_ids-3D_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 300</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">subject_ids=</span>(<span class="ruby-identifier">subject_ids</span>)
  <span class="ruby-identifier">users_subjects</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">subject_ids</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">users_subjects</span>.<span class="ruby-identifier">build</span> <span class="ruby-value">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span> } <span class="ruby-keyword">if</span> <span class="ruby-identifier">subject_ids</span>
  <span class="ruby-identifier">subject_ids</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-suggested_lessons">
            
              <b>suggested_lessons</b>(n)
            
            <a href="../classes/User.html#method-i-suggested_lessons" name="method-i-suggested_lessons" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-suggested_lessons-label-Description">Description</h3>

<p>Returns the first n suggested lessons (lessons which are public, not owned
nor linked by the user, with a subject in common with him, ordered by date
of last modification). Each lesson has its status set with <a
href="Lesson.html#method-i-set_status">Lesson#set_status</a>. Used in <a
href="DashboardController.html#method-i-index">DashboardController#index</a>.</p>

<h3 id="method-i-suggested_lessons-label-Args">Args</h3>
<ul><li>
<p><em>n</em>: the number of requested suggested lessons</p>
</li></ul>

<h3 id="method-i-suggested_lessons-label-Returns">Returns</h3>

<p>An array of objects of type <a href="Lesson.html">Lesson</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-suggested_lessons_source')" id="l_method-i-suggested_lessons_source">show</a>
                
              </p>
              <div id="method-i-suggested_lessons_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 783</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">suggested_lessons</span>(<span class="ruby-identifier">n</span>)
  <span class="ruby-identifier">n</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">subject_ids</span> = []
  <span class="ruby-constant">UsersSubject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">us</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">subject_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">us</span>.<span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:subject</span>, <span class="ruby-value">:user</span>).<span class="ruby-identifier">select</span>(<span class="ruby-node">&quot;lessons.*, 0 AS bookmarks_count, 0 AS virtuals_count, (SELECT COUNT (*) FROM likes WHERE likes.lesson_id = lessons.id AND likes.user_id = #{self.class.connection.quote self.id.to_i}) AS likes_count&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? AND user_id != ? AND subject_id IN (?) AND NOT EXISTS (SELECT * FROM bookmarks WHERE bookmarks.bookmarkable_type = ? AND bookmarks.bookmarkable_id = lessons.id AND bookmarks.user_id = ?)&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">subject_ids</span>, <span class="ruby-string">&#39;Lesson&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">n</span>)
  <span class="ruby-identifier">ids</span> = []
  <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">l</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, {<span class="ruby-value">:bookmarked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bookmarks_count</span>, <span class="ruby-value">:in_vc</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:virtuals_count</span>, <span class="ruby-value">:liked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:likes_count</span>}
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">covers</span> = {}
  <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ids</span>, <span class="ruby-value">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;cover&#39;</span>).<span class="ruby-identifier">preload</span>(<span class="ruby-value">:media_elements_slides</span>, {<span class="ruby-value">:media_elements_slides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:media_element</span>}).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cov</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">covers</span>[<span class="ruby-identifier">cov</span>.<span class="ruby-identifier">lesson_id</span>] = <span class="ruby-identifier">cov</span>
  <span class="ruby-keyword">end</span>
  {<span class="ruby-value">:records</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp</span>, <span class="ruby-value">:covers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">covers</span>}
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-suggested_media_elements">
            
              <b>suggested_media_elements</b>(n)
            
            <a href="../classes/User.html#method-i-suggested_media_elements" name="method-i-suggested_media_elements" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-suggested_media_elements-label-Description">Description</h3>

<p>Returns the first n suggested elements (elements which are public, not
owned nor linked by the user, ordered by date of publication). Each element
has its status set with <a
href="MediaElement.html#method-i-set_status">MediaElement#set_status</a>.
Used in <a
href="DashboardController.html#method-i-index">DashboardController#index</a>.</p>

<h3 id="method-i-suggested_media_elements-label-Args">Args</h3>
<ul><li>
<p><em>n</em>: the number of requested suggested elements</p>
</li></ul>

<h3 id="method-i-suggested_media_elements-label-Returns">Returns</h3>

<p>An array of objects of type <a href="MediaElement.html">MediaElement</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-suggested_media_elements_source')" id="l_method-i-suggested_media_elements_source">show</a>
                
              </p>
              <div id="method-i-suggested_media_elements_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 814</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">suggested_media_elements</span>(<span class="ruby-identifier">n</span>)
  <span class="ruby-identifier">n</span> = <span class="ruby-number">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-number">0</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;media_elements.*, 0 AS bookmarks_count&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? AND user_id != ? AND NOT EXISTS (SELECT * FROM bookmarks WHERE bookmarks.bookmarkable_type = ? AND bookmarks.bookmarkable_id = media_elements.id AND bookmarks.user_id = ?)&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-string">&#39;MediaElement&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;publication_date DESC&#39;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">n</span>)
  <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">me</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">me</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, {<span class="ruby-value">:bookmarked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bookmarks_count</span>}
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-super_admin-3F">
            
              <b>super_admin?</b>()
            
            <a href="../classes/User.html#method-i-super_admin-3F" name="method-i-super_admin-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-super_admin-3F-label-Description">Description</h3>

<p>Checks if the user is super admin or not (used in <a
href="User.html#method-i-admin-3F">#admin?</a> and <a
href="User.html#method-i-destroy_with_dependencies">#destroy_with_dependencies</a>)</p>

<h3 id="method-i-super_admin-3F-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-super_admin-3F_source')" id="l_method-i-super_admin-3F_source">show</a>
                
              </p>
              <div id="method-i-super_admin-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1054</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">super_admin?</span>
  <span class="ruby-identifier">super_admin</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">admin</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">super_admin</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">super_admin</span>.<span class="ruby-identifier">id</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-tot_notifications_number">
            
              <b>tot_notifications_number</b>()
            
            <a href="../classes/User.html#method-i-tot_notifications_number" name="method-i-tot_notifications_number" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-tot_notifications_number-label-Description">Description</h3>

<p>Gets the total number of notifications associated to the user (used in <a
href="ApplicationController.html#method-i-initialize_layout">ApplicationController#initialize_layout</a>
and <a
href="NotificationsController.html#method-i-destroy">NotificationsController#destroy</a>)</p>

<h3 id="method-i-tot_notifications_number-label-Returns">Returns</h3>

<p>An integer</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-tot_notifications_number_source')" id="l_method-i-tot_notifications_number_source">show</a>
                
              </p>
              <div id="method-i-tot_notifications_number_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 913</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">tot_notifications_number</span>
  <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-trial-3F">
            
              <b>trial?</b>()
            
            <a href="../classes/User.html#method-i-trial-3F" name="method-i-trial-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-trial-3F-label-Description">Description</h3>

<p>True if the user is trial</p>

<h3 id="method-i-trial-3F-label-Returns">Returns</h3>

<p>Boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-trial-3F_source')" id="l_method-i-trial-3F_source">show</a>
                
              </p>
              <div id="method-i-trial-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 271</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">trial?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">admin?</span>
  <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;saas_registration_mode&#39;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">purchase_id</span>.<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-trial_to_expiration">
            
              <b>trial_to_expiration</b>()
            
            <a href="../classes/User.html#method-i-trial_to_expiration" name="method-i-trial_to_expiration" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-trial_to_expiration-label-Description">Description</h3>

<p>Returns the seconds missing to the expiration of the trial account</p>

<h3 id="method-i-trial_to_expiration-label-Returns">Returns</h3>

<p>An integer</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-trial_to_expiration_source')" id="l_method-i-trial_to_expiration_source">show</a>
                
              </p>
              <div id="method-i-trial_to_expiration_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 170</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">trial_to_expiration</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">trial?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">created_at</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> (<span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;saas_trial_duration&#39;</span>] <span class="ruby-operator">*</span> <span class="ruby-number">86400</span>) <span class="ruby-operator">-</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">zone</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-trial_to_expiration_percentage">
            
              <b>trial_to_expiration_percentage</b>()
            
            <a href="../classes/User.html#method-i-trial_to_expiration_percentage" name="method-i-trial_to_expiration_percentage" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-trial_to_expiration_percentage-label-Description">Description</h3>

<p>Returns a string representing the percentage of trial expiration</p>

<h3 id="method-i-trial_to_expiration_percentage-label-Returns">Returns</h3>

<p>An integer</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-trial_to_expiration_percentage_source')" id="l_method-i-trial_to_expiration_percentage_source">show</a>
                
              </p>
              <div id="method-i-trial_to_expiration_percentage_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 183</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">trial_to_expiration_percentage</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">trial?</span>
  <span class="ruby-node">&quot;#{((100.to_f * self.trial_to_expiration.to_f) / (SETTINGS[&#39;saas_trial_duration&#39;].to_f * 86400.to_f)).to_s}%&quot;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-video_editor_available">
            
              <b>video_editor_available</b>()
            
            <a href="../classes/User.html#method-i-video_editor_available" name="method-i-video_editor_available" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-video_editor_available-label-Description">Description</h3>

<p>Checks if the <a href="Video.html">Video</a> Editor is available (this is
true if there is no <a href="Video.html">Video</a> in conversion at the
moment); used in the filters of <a
href="VideoEditorController.html">VideoEditorController</a></p>

<h3 id="method-i-video_editor_available-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-video_editor_available_source')" id="l_method-i-video_editor_available_source">show</a>
                
              </p>
              <div id="method-i-video_editor_available_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 370</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">video_editor_available</span>
  <span class="ruby-constant">Video</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:converted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">all?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">record</span><span class="ruby-operator">|</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">uploaded?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">modified?</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-video_editor_cache">
            
              <b>video_editor_cache</b>()
            
            <a href="../classes/User.html#method-i-video_editor_cache" name="method-i-video_editor_cache" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-video_editor_cache-label-Description">Description</h3>

<p>Returns the current <a href="Video.html">Video</a> Editor cache for this
user</p>

<h3 id="method-i-video_editor_cache-label-Returns">Returns</h3>

<p>A hash with parameters (for a sample structure, see <a
href="Media/Video/Editing/Parameters.html#method-i-convert_parameters">Media::Video::Editing::Parameters#convert_parameters</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-video_editor_cache_source')" id="l_method-i-video_editor_cache_source">show</a>
                
              </p>
              <div id="method-i-video_editor_cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 222</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">video_editor_cache</span>
  <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:video_editor_cache</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-video_editor_cache-21">
            
              <b>video_editor_cache!</b>(cache = nil)
            
            <a href="../classes/User.html#method-i-video_editor_cache-21" name="method-i-video_editor_cache-21" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-video_editor_cache-21-label-Description">Description</h3>

<p>Saves the <a href="Video.html">Video</a> Editor cache; if the param is
<code>nil</code>, the cache is emptied</p>

<h3 id="method-i-video_editor_cache-21-label-Args">Args</h3>
<ul><li>
<p><em>cache</em>: the cache to be saved (it must be a hash with the structure
defined in <a
href="Media/Video/Editing/Parameters.html#method-i-convert_parameters">Media::Video::Editing::Parameters#convert_parameters</a>;
if <code>nil</code> it empties the cache)</p>
</li></ul>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-video_editor_cache-21_source')" id="l_method-i-video_editor_cache-21_source">show</a>
                
              </p>
              <div id="method-i-video_editor_cache-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 209</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">video_editor_cache!</span>(<span class="ruby-identifier">cache</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">update_attribute</span> <span class="ruby-value">:metadata</span>, <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">marshal_dump</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">video_editor_cache</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cache</span>))
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
              
      <div class="sectiontitle">Instance Private methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-get_tags_associated_to_lesson_search">
            
              <b>get_tags_associated_to_lesson_search</b>(word, filter, subject_id, school_level_id)
            
            <a href="../classes/User.html#method-i-get_tags_associated_to_lesson_search" name="method-i-get_tags_associated_to_lesson_search" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Submethod of <a
href="User.html#method-i-search_lessons">#search_lessons</a>. It returns
the first <code>n</code> tags associated to the result of the research,
ordered by number of occurrences of these tags among the results; if the
<code>word</code> corresponds to a tag, this tag is put in the first place
of the result even if it wouldn&#39;t be first according to the normal
ordering.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-get_tags_associated_to_lesson_search_source')" id="l_method-i-get_tags_associated_to_lesson_search_source">show</a>
                
              </p>
              <div id="method-i-get_tags_associated_to_lesson_search_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1250</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">get_tags_associated_to_lesson_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">school_level_id</span>)
  <span class="ruby-identifier">limit</span> = <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;tags_limit_in_search_engine&#39;</span>]
  <span class="ruby-identifier">params</span> = [<span class="ruby-node">&quot;#{word}%&quot;</span>]
  <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN tags ON (tags.id = taggings.tag_id) INNER JOIN lessons ON (taggings.taggable_type = &#39;Lesson&#39; AND taggings.taggable_id = lessons.id)&quot;</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;tags.word LIKE ?&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.subject_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">school_level_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.school_level_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">school_level_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND (lessons.is_public = ? OR lessons.user_id = ?)&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.is_public = ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ONLY_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.user_id = ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">NOT_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.is_public = ? AND lessons.user_id != ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;tags.*, COUNT(*) AS tags_count&#39;</span>
  <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-identifier">where</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;tags.word LIKE ?&#39;</span>, <span class="ruby-string">&#39;tags.word = ?&#39;</span>)
  <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;tags.word != ? AND #{where}&quot;</span>
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where_for_current_tag</span>, <span class="ruby-identifier">word</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">params</span>[<span class="ruby-number">1</span>, <span class="ruby-identifier">params</span>.<span class="ruby-identifier">length</span>]).<span class="ruby-identifier">limit</span>(<span class="ruby-number">1</span>).<span class="ruby-identifier">present?</span>
    <span class="ruby-identifier">limit</span> <span class="ruby-operator">-=</span> <span class="ruby-number">1</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_by_word</span>(<span class="ruby-identifier">word</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;tags.id&#39;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">word</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">params</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;tags_count DESC, tags.word ASC&#39;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-get_tags_associated_to_media_element_search">
            
              <b>get_tags_associated_to_media_element_search</b>(word, filter)
            
            <a href="../classes/User.html#method-i-get_tags_associated_to_media_element_search" name="method-i-get_tags_associated_to_media_element_search" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Submethod of <a
href="User.html#method-i-search_media_elements">#search_media_elements</a>.
It returns the first <code>n</code> tags associated to the result of the
research, ordered by number of occurrences of these tags among the results;
if the <code>word</code> corresponds to a tag, this tag is put in the first
place of the result even if it wouldn&#39;t be first according to the
normal ordering.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-get_tags_associated_to_media_element_search_source')" id="l_method-i-get_tags_associated_to_media_element_search_source">show</a>
                
              </p>
              <div id="method-i-get_tags_associated_to_media_element_search_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1291</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">get_tags_associated_to_media_element_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">limit</span> = <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;tags_limit_in_search_engine&#39;</span>]
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;tags.word != ? AND tags.word LIKE ? AND (media_elements.is_public = ? OR media_elements.user_id = ?)&#39;</span>
  <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-string">&#39;tags.word = ? AND (media_elements.is_public = ? OR media_elements.user_id = ?)&#39;</span>
  <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN tags ON (tags.id = taggings.tag_id) INNER JOIN media_elements ON (taggings.taggable_type = &#39;MediaElement&#39; AND taggings.taggable_id = media_elements.id)&quot;</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;tags.*, COUNT(*) AS tags_count&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">VIDEO</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Video&#39;&quot;</span>
      <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-node">&quot;#{where_for_current_tag} AND media_elements.sti_type = &#39;Video&#39;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">AUDIO</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Audio&#39;&quot;</span>
      <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-node">&quot;#{where_for_current_tag} AND media_elements.sti_type = &#39;Audio&#39;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Image&#39;&quot;</span>
      <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-node">&quot;#{where_for_current_tag} AND media_elements.sti_type = &#39;Image&#39;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where_for_current_tag</span>, <span class="ruby-identifier">word</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-number">1</span>).<span class="ruby-identifier">present?</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_by_word</span>(<span class="ruby-identifier">word</span>)
    <span class="ruby-identifier">limit</span> <span class="ruby-operator">-=</span> <span class="ruby-number">1</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;tags.id&#39;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">word</span>, <span class="ruby-node">&quot;#{word}%&quot;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;tags_count DESC, tags.word ASC&#39;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-init_validation">
            
              <b>init_validation</b>()
            
            <a href="../classes/User.html#method-i-init_validation" name="method-i-init_validation" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Initializes validation objects (see <a
href="Valid.html#method-c-get_association">Valid.get_association</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-init_validation_source')" id="l_method-i-init_validation_source">show</a>
                
              </p>
              <div id="method-i-init_validation_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1527</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">init_validation</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">Valid</span>.<span class="ruby-identifier">get_association</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:id</span>
  <span class="ruby-ivar">@school_level</span> = <span class="ruby-constant">Valid</span>.<span class="ruby-identifier">get_association</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:school_level_id</span>
  <span class="ruby-ivar">@purchase</span> = <span class="ruby-constant">Valid</span>.<span class="ruby-identifier">get_association</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:purchase_id</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-search_lessons_with_tag">
            
              <b>search_lessons_with_tag</b>(word, offset, limit, filter, subject_id, order_by, school_level_id)
            
            <a href="../classes/User.html#method-i-search_lessons_with_tag" name="method-i-search_lessons_with_tag" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Submethod of <a
href="User.html#method-i-search_lessons">#search_lessons</a>: if
<code>word</code> is a Fixnum, it extracts all the lessons associated to
that word, otherwise it extracts all the lessons whose tags match the
<code>word</code>. Results are filtered by the <code>filter</code> (chosen
among the ones in <a href="Filters.html">Filters</a>) and by
<code>subject_id</code>, and ordered by <code>order_by</code> (chosen among
<a href="SearchOrders.html">SearchOrders</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-search_lessons_with_tag_source')" id="l_method-i-search_lessons_with_tag_source">show</a>
                
              </p>
              <div id="method-i-search_lessons_with_tag_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1391</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">search_lessons_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order_by</span>, <span class="ruby-identifier">school_level_id</span>)
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">params</span> = [<span class="ruby-node">&quot;#{word}%&quot;</span>]
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;lessons.id AS my_lesson_id&#39;</span>
  <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN tags ON (tags.id = taggings.tag_id) INNER JOIN lessons ON (taggings.taggable_type = &#39;Lesson&#39; AND taggings.taggable_id = lessons.id)&quot;</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;tags.word LIKE ?&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Fixnum</span>
    <span class="ruby-identifier">params</span> = [<span class="ruby-identifier">word</span>]
    <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN lessons ON (taggings.taggable_type = &#39;Lesson&#39; AND taggings.taggable_id = lessons.id)&quot;</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;taggings.tag_id = ?&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;lessons.updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">LIKES</span>
      <span class="ruby-identifier">select</span> = <span class="ruby-node">&quot;#{select}, (SELECT COUNT(*) FROM likes WHERE (likes.lesson_id = lessons.id)) AS likes_count&quot;</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;likes_count DESC, lessons.updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;lessons.title ASC, lessons.updated_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.subject_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">school_level_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.school_level_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">school_level_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND (lessons.is_public = ? OR lessons.user_id = ?)&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.is_public = ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ONLY_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.user_id = ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">NOT_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.is_public = ? AND lessons.user_id != ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = []
  <span class="ruby-identifier">ids</span> = []
  <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;lessons.id&#39;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">params</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">single_lesson_item</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">single_lesson_item</span>.<span class="ruby-identifier">my_lesson_id</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">order</span> = <span class="ruby-identifier">order</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;likes&#39;</span>, <span class="ruby-string">&#39;likes_general&#39;</span>)
  <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:subject</span>, <span class="ruby-value">:user</span>, <span class="ruby-value">:school_level</span>, {<span class="ruby-value">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:location</span>}).<span class="ruby-identifier">select</span>(<span class="ruby-node">&quot;
    lessons.*,
    (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id AND bookmarks.user_id = #{self.class.connection.quote self.id.to_i}) AS bookmarks_count,
    (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id) AS all_bookmarks_count,
    (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id AND bookmarks.user_id != #{self.class.connection.quote self.id} AND bookmarks.created_at &lt; lessons.updated_at) AS notification_bookmarks,
    (SELECT COUNT (*) FROM virtual_classroom_lessons WHERE virtual_classroom_lessons.lesson_id = lessons.id AND virtual_classroom_lessons.user_id = #{self.class.connection.quote self.id.to_i}) AS virtuals_count,
    (SELECT COUNT (*) FROM likes WHERE likes.lesson_id = lessons.id AND likes.user_id = #{self.class.connection.quote self.id.to_i}) AS likes_count,
    (SELECT COUNT (*) FROM likes WHERE likes.lesson_id = lessons.id) AS likes_general_count
  &quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ids</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lesson</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, {<span class="ruby-value">:bookmarked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bookmarks_count</span>, <span class="ruby-value">:in_vc</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:virtuals_count</span>, <span class="ruby-value">:liked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:likes_count</span>}
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lesson</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>] = <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;lessons.id&#39;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">params</span>).<span class="ruby-identifier">count</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>], <span class="ruby-identifier">limit</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:covers</span>] = {}
  <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ids</span>, <span class="ruby-value">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;cover&#39;</span>).<span class="ruby-identifier">preload</span>(<span class="ruby-value">:media_elements_slides</span>, {<span class="ruby-value">:media_elements_slides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:media_element</span>}).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cov</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:covers</span>][<span class="ruby-identifier">cov</span>.<span class="ruby-identifier">lesson_id</span>] = <span class="ruby-identifier">cov</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-search_lessons_without_tag">
            
              <b>search_lessons_without_tag</b>(offset, limit, filter, subject_id, order_by, school_level_id)
            
            <a href="../classes/User.html#method-i-search_lessons_without_tag" name="method-i-search_lessons_without_tag" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Submethod of <a
href="User.html#method-i-search_lessons">#search_lessons</a>. It returns
all the lessons in the database, filtered by <code>filter</code> (chosen
among the ones in <a href="Filters.html">Filters</a>) and by
<code>subject_id</code>, and ordered by <code>order_by</code> (chosen among
the ones in <a href="SearchOrders.html">SearchOrders</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-search_lessons_without_tag_source')" id="l_method-i-search_lessons_without_tag_source">show</a>
                
              </p>
              <div id="method-i-search_lessons_without_tag_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1464</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">search_lessons_without_tag</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order_by</span>, <span class="ruby-identifier">school_level_id</span>)
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">params</span> = []
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-node">&quot;
    lessons.*,
    (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id AND bookmarks.user_id = #{self.class.connection.quote self.id.to_i}) AS bookmarks_count,
    (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id) AS all_bookmarks_count,
    (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;Lesson&#39;} AND bookmarks.bookmarkable_id = lessons.id AND bookmarks.user_id != #{self.class.connection.quote self.id} AND bookmarks.created_at &lt; lessons.updated_at) AS notification_bookmarks,
    (SELECT COUNT (*) FROM virtual_classroom_lessons WHERE virtual_classroom_lessons.lesson_id = lessons.id AND virtual_classroom_lessons.user_id = #{self.class.connection.quote self.id.to_i}) AS virtuals_count,
    (SELECT COUNT (*) FROM likes WHERE likes.lesson_id = lessons.id AND likes.user_id = #{self.class.connection.quote self.id.to_i}) AS likes_count,
    (SELECT COUNT (*) FROM likes WHERE likes.lesson_id = lessons.id) AS likes_general_count
  &quot;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">LIKES</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;likes_general_count DESC, updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;title ASC, updated_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;(is_public = ? OR user_id = ?)&#39;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;is_public = ?&#39;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ONLY_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;user_id = ?&#39;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">NOT_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;is_public = ? AND user_id != ?&#39;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND subject_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">school_level_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND school_level_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">school_level_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = []
  <span class="ruby-identifier">ids</span> = []
  <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">preload</span>(<span class="ruby-value">:subject</span>, <span class="ruby-value">:user</span>, <span class="ruby-value">:school_level</span>, {<span class="ruby-value">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:location</span>}).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">params</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lesson</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, {<span class="ruby-value">:bookmarked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bookmarks_count</span>, <span class="ruby-value">:in_vc</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:virtuals_count</span>, <span class="ruby-value">:liked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:likes_count</span>}
    <span class="ruby-identifier">ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lesson</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>] = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">params</span>).<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>], <span class="ruby-identifier">limit</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:covers</span>] = {}
  <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ids</span>, <span class="ruby-value">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;cover&#39;</span>).<span class="ruby-identifier">preload</span>(<span class="ruby-value">:media_elements_slides</span>, {<span class="ruby-value">:media_elements_slides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:media_element</span>}).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cov</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:covers</span>][<span class="ruby-identifier">cov</span>.<span class="ruby-identifier">lesson_id</span>] = <span class="ruby-identifier">cov</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-search_media_elements_with_tag">
            
              <b>search_media_elements_with_tag</b>(word, offset, limit, filter, order_by)
            
            <a href="../classes/User.html#method-i-search_media_elements_with_tag" name="method-i-search_media_elements_with_tag" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Submethod of <a
href="User.html#method-i-search_media_elements">#search_media_elements</a>:
if <code>word</code> is a Fixnum, it extracts all the elements associated
to that word, otherwise it extracts all the elements whose tags match the
<code>word</code>. Results are filtered by the <code>filter</code> (chosen
among the ones in <a href="Filters.html">Filters</a>), and ordered by
<code>order_by</code> (chosen among <a
href="SearchOrders.html">SearchOrders</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-search_media_elements_with_tag_source')" id="l_method-i-search_media_elements_with_tag_source">show</a>
                
              </p>
              <div id="method-i-search_media_elements_with_tag_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1317</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">search_media_elements_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order_by</span>)
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">params</span> = [<span class="ruby-node">&quot;#{word}%&quot;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>]
  <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN tags ON (tags.id = taggings.tag_id) INNER JOIN media_elements ON (taggings.taggable_type = &#39;MediaElement&#39; AND taggings.taggable_id = media_elements.id)&quot;</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;tags.word LIKE ? AND (media_elements.is_public = ? OR media_elements.user_id = ?)&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Fixnum</span>
    <span class="ruby-identifier">params</span> = [<span class="ruby-identifier">word</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>]
    <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN media_elements ON (taggings.taggable_type = &#39;MediaElement&#39; AND taggings.taggable_id = media_elements.id)&quot;</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;taggings.tag_id = ? AND (media_elements.is_public = ? OR media_elements.user_id = ?)&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;media_elements.updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;media_elements.title ASC, media_elements.updated_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">VIDEO</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Video&#39;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">AUDIO</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Audio&#39;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Image&#39;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = []
  <span class="ruby-identifier">ids</span> = <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;media_elements.id&#39;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-number">0</span>], <span class="ruby-identifier">params</span>[<span class="ruby-number">1</span>], <span class="ruby-identifier">params</span>[<span class="ruby-number">2</span>]).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>).<span class="ruby-identifier">pluck</span>(<span class="ruby-string">&#39;media_elements.id&#39;</span>)
  <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">select</span>( <span class="ruby-node">&quot;media_elements.*, (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;MediaElement&#39;} AND bookmarks.bookmarkable_id = media_elements.id AND bookmarks.user_id = #{self.class.connection.quote self.id.to_i}) AS bookmarks_count, (SELECT COUNT(*) FROM media_elements_slides WHERE (media_elements_slides.media_element_id = media_elements.id)) AS instances&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ids</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">media_element</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">media_element</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, {<span class="ruby-value">:bookmarked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bookmarks_count</span>}
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">media_element</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>] = <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;media_elements.id&#39;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-number">0</span>], <span class="ruby-identifier">params</span>[<span class="ruby-number">1</span>], <span class="ruby-identifier">params</span>[<span class="ruby-number">2</span>]).<span class="ruby-identifier">count</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>], <span class="ruby-identifier">limit</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-search_media_elements_without_tag">
            
              <b>search_media_elements_without_tag</b>(offset, limit, filter, order_by)
            
            <a href="../classes/User.html#method-i-search_media_elements_without_tag" name="method-i-search_media_elements_without_tag" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Submethod of <a
href="User.html#method-i-search_media_elements">#search_media_elements</a>.
It returns all the elements in the database, filtered by
<code>filter</code> (chosen among the ones in <a
href="Filters.html">Filters</a>), and ordered by <code>order_by</code>
(chosen among the ones in <a href="SearchOrders.html">SearchOrders</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-search_media_elements_without_tag_source')" id="l_method-i-search_media_elements_without_tag_source">show</a>
                
              </p>
              <div id="method-i-search_media_elements_without_tag_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1354</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">search_media_elements_without_tag</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order_by</span>)
  <span class="ruby-identifier">select</span> = <span class="ruby-node">&quot;media_elements.*, (SELECT COUNT (*) FROM bookmarks WHERE bookmarks.bookmarkable_type = #{self.class.connection.quote &#39;MediaElement&#39;} AND bookmarks.bookmarkable_id = media_elements.id AND bookmarks.user_id = #{self.class.connection.quote self.id.to_i}) AS bookmarks_count, (SELECT COUNT(*) FROM media_elements_slides WHERE (media_elements_slides.media_element_id = media_elements.id)) AS instances&quot;</span>
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;title ASC, updated_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">count</span> = <span class="ruby-number">0</span>
  <span class="ruby-identifier">query</span> = []
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_MEDIA_ELEMENTS</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">VIDEO</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Video</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Video</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">AUDIO</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Audio</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Audio</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGE</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Image</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Image</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = []
  <span class="ruby-identifier">query</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">q</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, {<span class="ruby-value">:bookmarked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:bookmarks_count</span>}
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">q</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>] = <span class="ruby-identifier">count</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>], <span class="ruby-identifier">limit</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_accounts_number_for_purchase">
            
              <b>validate_accounts_number_for_purchase</b>()
            
            <a href="../classes/User.html#method-i-validate_accounts_number_for_purchase" name="method-i-validate_accounts_number_for_purchase" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Validates that there are not too many users associated to the same purchase</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_accounts_number_for_purchase_source')" id="l_method-i-validate_accounts_number_for_purchase_source">show</a>
                
              </p>
              <div id="method-i-validate_accounts_number_for_purchase_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1534</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_accounts_number_for_purchase</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:purchase_id</span>, <span class="ruby-value">:too_many_users_for_purchase</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@purchase</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">purchase_id</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">purchase_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@purchase</span>.<span class="ruby-identifier">accounts_number</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:purchase_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">purchase_id</span>).<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:purchase_id</span>, <span class="ruby-value">:too_many_users_for_purchase</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@purchase</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@purchase</span>.<span class="ruby-identifier">accounts_number</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:purchase_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">purchase_id</span>).<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_associations">
            
              <b>validate_associations</b>()
            
            <a href="../classes/User.html#method-i-validate_associations" name="method-i-validate_associations" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Validates the presence of all the associated objects</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_associations_source')" id="l_method-i-validate_associations_source">show</a>
                
              </p>
              <div id="method-i-validate_associations_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1543</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_associations</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span> <span class="ruby-value">:school_level_id</span>, <span class="ruby-value">:doesnt_exist</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@school_level</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span> <span class="ruby-value">:purchase_id</span>, <span class="ruby-value">:doesnt_exist</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@purchase</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">purchase_id</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">location_id</span>
    <span class="ruby-ivar">@location</span> = <span class="ruby-constant">Valid</span>.<span class="ruby-identifier">get_association</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:location_id</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span> <span class="ruby-value">:location_id</span>, <span class="ruby-value">:doesnt_exist</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@location</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@location</span>.<span class="ruby-identifier">sti_type</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;location_types&#39;</span>].<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_email">
            
              <b>validate_email</b>()
            
            <a href="../classes/User.html#method-i-validate_email" name="method-i-validate_email" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Validates the correct format of the email (see <a
href="Valid.html#method-c-email-3F">Valid.email?</a>)</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_email_source')" id="l_method-i-validate_email_source">show</a>
                
              </p>
              <div id="method-i-validate_email_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1558</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_email</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:email</span>, <span class="ruby-value">:not_a_valid_email</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Valid</span>.<span class="ruby-identifier">email?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_email_not_changed">
            
              <b>validate_email_not_changed</b>()
            
            <a href="../classes/User.html#method-i-validate_email_not_changed" name="method-i-validate_email_not_changed" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>If the user is not new, it validates that the email didn&#39;t change</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_email_not_changed_source')" id="l_method-i-validate_email_not_changed_source">show</a>
                
              </p>
              <div id="method-i-validate_email_not_changed_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/user.rb, line 1553</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_email_not_changed</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span> <span class="ruby-value">:email</span>, <span class="ruby-value">:changed</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">changed</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;email&#39;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    