<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/assets/javascripts/players.js - DESY</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="DESY"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdminAutocomplete.html">AdminAutocomplete</a></li>
            
                <li><a href="../classes/AdminBrowserSupport.html">AdminBrowserSupport</a></li>
            
                <li><a href="../classes/AdminCollapsed.html">AdminCollapsed</a></li>
            
                <li><a href="../classes/AdminDocumentReady.html">AdminDocumentReady</a></li>
            
                <li><a href="../classes/AjaxLoaderBinder.html">AjaxLoaderBinder</a></li>
            
                <li><a href="../classes/AjaxLoaderDocumentReady.html">AjaxLoaderDocumentReady</a></li>
            
                <li><a href="../classes/AjaxLoaderVisibility.html">AjaxLoaderVisibility</a></li>
            
                <li><a href="../classes/AudioEditorComponents.html">AudioEditorComponents</a></li>
            
                <li><a href="../classes/AudioEditorCutters.html">AudioEditorCutters</a></li>
            
                <li><a href="../classes/AudioEditorDocumentReady.html">AudioEditorDocumentReady</a></li>
            
                <li><a href="../classes/AudioEditorGalleries.html">AudioEditorGalleries</a></li>
            
                <li><a href="../classes/AudioEditorGeneral.html">AudioEditorGeneral</a></li>
            
                <li><a href="../classes/AudioEditorGraphics.html">AudioEditorGraphics</a></li>
            
                <li><a href="../classes/AudioEditorPreview.html">AudioEditorPreview</a></li>
            
                <li><a href="../classes/AudioEditorScrollpain.html">AudioEditorScrollpain</a></li>
            
                <li><a href="../classes/BrowserSupportMain.html">BrowserSupportMain</a></li>
            
                <li><a href="../classes/ButtonsAccessories.html">ButtonsAccessories</a></li>
            
                <li><a href="../classes/ButtonsDocumentReady.html">ButtonsDocumentReady</a></li>
            
                <li><a href="../classes/ButtonsLesson.html">ButtonsLesson</a></li>
            
                <li><a href="../classes/ButtonsMediaElement.html">ButtonsMediaElement</a></li>
            
                <li><a href="../classes/DashboardAccessories.html">DashboardAccessories</a></li>
            
                <li><a href="../classes/DashboardExpandedContents.html">DashboardExpandedContents</a></li>
            
                <li><a href="../classes/DashboardLessonDescriptions.html">DashboardLessonDescriptions</a></li>
            
                <li><a href="../classes/DashboardResizing.html">DashboardResizing</a></li>
            
                <li><a href="../classes/DialogsAccessories.html">DialogsAccessories</a></li>
            
                <li><a href="../classes/DialogsConfirmation.html">DialogsConfirmation</a></li>
            
                <li><a href="../classes/DialogsGalleries.html">DialogsGalleries</a></li>
            
                <li><a href="../classes/DialogsTimed.html">DialogsTimed</a></li>
            
                <li><a href="../classes/DialogsWithForm.html">DialogsWithForm</a></li>
            
                <li><a href="../classes/GalleriesAccessories.html">GalleriesAccessories</a></li>
            
                <li><a href="../classes/GalleriesDocumentReady.html">GalleriesDocumentReady</a></li>
            
                <li><a href="../classes/GalleriesInitializers.html">GalleriesInitializers</a></li>
            
                <li><a href="../classes/GeneralCentering.html">GeneralCentering</a></li>
            
                <li><a href="../classes/GeneralDocumentReady.html">GeneralDocumentReady</a></li>
            
                <li><a href="../classes/GeneralMiscellanea.html">GeneralMiscellanea</a></li>
            
                <li><a href="../classes/GeneralUrls.html">GeneralUrls</a></li>
            
                <li><a href="../classes/ImageEditorDocumentReady.html">ImageEditorDocumentReady</a></li>
            
                <li><a href="../classes/ImageEditorGraphics.html">ImageEditorGraphics</a></li>
            
                <li><a href="../classes/ImageEditorImageScale.html">ImageEditorImageScale</a></li>
            
                <li><a href="../classes/ImageEditorTexts.html">ImageEditorTexts</a></li>
            
                <li><a href="../classes/JqueryBrowsersDetection.html">JqueryBrowsersDetection</a></li>
            
                <li><a href="../classes/JqueryPatchesBrowsers.html">JqueryPatchesBrowsers</a></li>
            
                <li><a href="../classes/LessonEditorCurrentSlide.html">LessonEditorCurrentSlide</a></li>
            
                <li><a href="../classes/LessonEditorDocumentReady.html">LessonEditorDocumentReady</a></li>
            
                <li><a href="../classes/LessonEditorForms.html">LessonEditorForms</a></li>
            
                <li><a href="../classes/LessonEditorGalleries.html">LessonEditorGalleries</a></li>
            
                <li><a href="../classes/LessonEditorImageResizing.html">LessonEditorImageResizing</a></li>
            
                <li><a href="../classes/LessonEditorJqueryAnimations.html">LessonEditorJqueryAnimations</a></li>
            
                <li><a href="../classes/LessonEditorSlideLoading.html">LessonEditorSlideLoading</a></li>
            
                <li><a href="../classes/LessonEditorSlidesNavigation.html">LessonEditorSlidesNavigation</a></li>
            
                <li><a href="../classes/LessonEditorTinyMCE.html">LessonEditorTinyMCE</a></li>
            
                <li><a href="../classes/LessonViewerDocumentReady.html">LessonViewerDocumentReady</a></li>
            
                <li><a href="../classes/LessonViewerGeneral.html">LessonViewerGeneral</a></li>
            
                <li><a href="../classes/LessonViewerGraphics.html">LessonViewerGraphics</a></li>
            
                <li><a href="../classes/LessonViewerPlaylist.html">LessonViewerPlaylist</a></li>
            
                <li><a href="../classes/LessonViewerSlidesNavigation.html">LessonViewerSlidesNavigation</a></li>
            
                <li><a href="../classes/MediaElementEditorCache.html">MediaElementEditorCache</a></li>
            
                <li><a href="../classes/MediaElementEditorConversion.html">MediaElementEditorConversion</a></li>
            
                <li><a href="../classes/MediaElementEditorDocumentReady.html">MediaElementEditorDocumentReady</a></li>
            
                <li><a href="../classes/MediaElementEditorForms.html">MediaElementEditorForms</a></li>
            
                <li><a href="../classes/MediaElementEditorHorizontalTimelines.html">MediaElementEditorHorizontalTimelines</a></li>
            
                <li><a href="../classes/NotificationsAccessories.html">NotificationsAccessories</a></li>
            
                <li><a href="../classes/NotificationsDocumentReady.html">NotificationsDocumentReady</a></li>
            
                <li><a href="../classes/NotificationsGraphics.html">NotificationsGraphics</a></li>
            
                <li><a href="../classes/PlayersAudioEditor.html">PlayersAudioEditor</a></li>
            
                <li><a href="../classes/PlayersCommon.html">PlayersCommon</a></li>
            
                <li><a href="../classes/PlayersDocumentReady.html">PlayersDocumentReady</a></li>
            
                <li><a href="../classes/PlayersGeneral.html">PlayersGeneral</a></li>
            
                <li><a href="../classes/PlayersVideoEditor.html">PlayersVideoEditor</a></li>
            
                <li><a href="../classes/ProfilePrelogin.html">ProfilePrelogin</a></li>
            
                <li><a href="../classes/ProfileUsers.html">ProfileUsers</a></li>
            
                <li><a href="../classes/SearchDocumentReady.html">SearchDocumentReady</a></li>
            
                <li><a href="../classes/TagsAccessories.html">TagsAccessories</a></li>
            
                <li><a href="../classes/TagsInitializers.html">TagsInitializers</a></li>
            
                <li><a href="../classes/UploaderDocumentReady.html">UploaderDocumentReady</a></li>
            
                <li><a href="../classes/UploaderGlobal.html">UploaderGlobal</a></li>
            
                <li><a href="../classes/UploaderLoadingBar.html">UploaderLoadingBar</a></li>
            
                <li><a href="../classes/VideoEditorAddComponents.html">VideoEditorAddComponents</a></li>
            
                <li><a href="../classes/VideoEditorComponents.html">VideoEditorComponents</a></li>
            
                <li><a href="../classes/VideoEditorCutters.html">VideoEditorCutters</a></li>
            
                <li><a href="../classes/VideoEditorDocumentReady.html">VideoEditorDocumentReady</a></li>
            
                <li><a href="../classes/VideoEditorGalleries.html">VideoEditorGalleries</a></li>
            
                <li><a href="../classes/VideoEditorGeneral.html">VideoEditorGeneral</a></li>
            
                <li><a href="../classes/VideoEditorPreview.html">VideoEditorPreview</a></li>
            
                <li><a href="../classes/VideoEditorPreviewAccessories.html">VideoEditorPreviewAccessories</a></li>
            
                <li><a href="../classes/VideoEditorReplaceComponents.html">VideoEditorReplaceComponents</a></li>
            
                <li><a href="../classes/VideoEditorScrollPain.html">VideoEditorScrollPain</a></li>
            
                <li><a href="../classes/VideoEditorTextComponentEditor.html">VideoEditorTextComponentEditor</a></li>
            
                <li><a href="../classes/VirtualClassroomDocumentReady.html">VirtualClassroomDocumentReady</a></li>
            
                <li><a href="../classes/VirtualClassroomJavaScriptAnimations.html">VirtualClassroomJavaScriptAnimations</a></li>
            
                <li><a href="../classes/VirtualClassroomMultipleLoading.html">VirtualClassroomMultipleLoading</a></li>
            
                <li><a href="../classes/VirtualClassroomSendLink.html">VirtualClassroomSendLink</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/admin.html">admin</a></li>
            
                <li><a href="../modules/ajax-loader.html">ajax-loader</a></li>
            
                <li><a href="../modules/audio-editor.html">audio-editor</a></li>
            
                <li><a href="../modules/browser-support.html">browser-support</a></li>
            
                <li><a href="../modules/buttons.html">buttons</a></li>
            
                <li><a href="../modules/dashboard.html">dashboard</a></li>
            
                <li><a href="../modules/dialogs.html">dialogs</a></li>
            
                <li><a href="../modules/galleries.html">galleries</a></li>
            
                <li><a href="../modules/general.html">general</a></li>
            
                <li><a href="../modules/image-editor.html">image-editor</a></li>
            
                <li><a href="../modules/jquery-browsers.html">jquery-browsers</a></li>
            
                <li><a href="../modules/jquery-patches.html">jquery-patches</a></li>
            
                <li><a href="../modules/lesson-editor.html">lesson-editor</a></li>
            
                <li><a href="../modules/lesson-viewer.html">lesson-viewer</a></li>
            
                <li><a href="../modules/media-element-editor.html">media-element-editor</a></li>
            
                <li><a href="../modules/notifications.html">notifications</a></li>
            
                <li><a href="../modules/players.html">players</a></li>
            
                <li><a href="../modules/profile.html">profile</a></li>
            
                <li><a href="../modules/search.html">search</a></li>
            
                <li><a href="../modules/tags.html">tags</a></li>
            
                <li><a href="../modules/uploader.html">uploader</a></li>
            
                <li><a href="../modules/video-editor.html">video-editor</a></li>
            
                <li><a href="../modules/virtual-classroom.html">virtual-classroom</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app/assets/javascripts/players.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
This module contains the javascript functions and initializers used in the &lt;b&gt;media players&lt;/b&gt; all over the application. The model can be divided into three main classes:
&lt;ul&gt;
  &lt;li&gt;{{#crossLink &quot;PlayersGeneral&quot;}}{{/crossLink}}, used in the generic players, for instance in {{#crossLinkModule &quot;lesson-editor&quot;}}{{/crossLinkModule}} and {{#crossLinkModule &quot;lesson-viewer&quot;}}{{/crossLinkModule}}&lt;/li&gt;
  &lt;li&gt;{{#crossLink &quot;PlayersAudioEditor&quot;}}{{/crossLink}}, used in the players of the module {{#crossLinkModule &quot;audio-editor&quot;}}{{/crossLinkModule}} (only players of kind &lt;b&gt;audio&lt;/b&gt;)&lt;/li&gt;
  &lt;li&gt;{{#crossLink &quot;PlayersVideoEditor&quot;}}{{/crossLink}}, used in the players of the module {{#crossLinkModule &quot;video-editor&quot;}}{{/crossLinkModule}} (mainly players of kind &lt;b&gt;video&lt;/b&gt;, but also of kind &lt;b&gt;audio&lt;/b&gt; for the background audio track).&lt;/li&gt;
&lt;/ul&gt;
@module players
**/





/**
This method is fired each time the audio component player receives an event of &lt;b&gt;timeupdate&lt;/b&gt;. There are two cases of use of this method:
&lt;ul&gt;
  &lt;li&gt;if the Audio Editor &lt;b&gt;is not in preview mode&lt;/b&gt;, it operates as a normal player (see {{#crossLink &quot;PlayersGeneral/initializeActionOfMediaTimeUpdater:method&quot;}}{{/crossLink}}), with very slight differences due to the different environment&lt;/li&gt;
  &lt;li&gt;if we are &lt;b&gt;in preview mode&lt;/b&gt;, the method acts as a counterpart of {{#crossLink &quot;AudioEditorPreview/startAudioEditorPreview:method&quot;}}{{/crossLink}}: at any time the seconds increase, the method updates the timer using {{#crossLink &quot;AudioEditorPreview/increaseAudioEditorPreviewTimer:method&quot;}}{{/crossLink}}; when the audio is over, if it&#x27;s not playing the last component, the method calls {{#crossLink &quot;AudioEditorPreview/startAudioEditorPreview:method&quot;}}{{/crossLink}} for the following one.&lt;/li&gt;
&lt;/ul&gt;
@method initializeActionOfMediaTimeUpdaterInAudioEditor
@for PlayersAudioEditor
@param media {String} HTML selector for the audio
@param identifier {Number} unique identifier for the audio component (see {{#crossLinkModule &quot;audio-editor&quot;}}{{/crossLinkModule}})
@param force_parsed_int {Boolean} forces the last second of the audio; normally it&#x27;s &lt;i&gt;false&lt;/i&gt;, except the case in which the duration of the audio is very close to the biggest lower integer (for instance, the duration is 10.01, which is very close to 10): in this case, the signal that the audio ended &lt;b&gt;is not received directly by the current method&lt;/b&gt;, but rather by the event handler &lt;b&gt;ended&lt;/b&gt; initialized in the end of {{#crossLink &quot;PlayersAudioEditor/initializeAudioEditorCutter:method&quot;}}{{/crossLink}}
**/
function initializeActionOfMediaTimeUpdaterInAudioEditor(media, identifier, force_parsed_int) {
  var component = $(&#x27;#audio_component_&#x27; + identifier);
  var audio_cut_to = component.data(&#x27;to&#x27;);
  var parsed_int = parseInt(media.currentTime);
  if(force_parsed_int) {
    parsed_int = audio_cut_to;
  }
  if($(&#x27;#info_container&#x27;).data(&#x27;in-preview&#x27;)) {
    if(parsed_int &gt; component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;)) {
      increaseAudioEditorPreviewTimer();
      if(parsed_int == audio_cut_to) {
        var old_start = component.data(&#x27;from&#x27;);
        component.find(&#x27;audio&#x27;)[0].pause();
        component.find(&#x27;._current_time&#x27;).html(secondsToDateString(old_start));
        component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, old_start);
        setCurrentTimeToMedia(component.find(&#x27;audio&#x27;), old_start);
        var next_component = component.next();
        if(next_component.length &gt; 0) {
          deselectAllAudioEditorComponentsInPreviewMode();
          var new_start = next_component.data(&#x27;from&#x27;);
          next_component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, new_start);
          next_component.find(&#x27;._current_time&#x27;).html(secondsToDateString(new_start));
          loadAudioComponentIfNotLoadedYet(next_component);
          setCurrentTimeToMedia(next_component.find(&#x27;audio&#x27;), new_start);
          startAudioEditorPreview(next_component);
        } else {
          leaveAudioEditorPreviewMode($(&#x27;._audio_editor_component&#x27;).first().attr(&#x27;id&#x27;));
        }
      } else {
        component.find(&#x27;._current_time&#x27;).html(secondsToDateString(parsed_int));
        component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, parsed_int);
      }
    }
  } else if(component.data(&#x27;playing&#x27;)) {
    if(parsed_int == (audio_cut_to)) {
      var initial_time = component.data(&#x27;from&#x27;);
      component.find(&#x27;._media_player_pause_in_audio_editor_preview&#x27;).click();
      component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, initial_time);
      component.find(&#x27;._current_time&#x27;).html(secondsToDateString(initial_time));
      setCurrentTimeToMedia($(media), initial_time);
    } else if(!component.find(&#x27;._media_player_play_in_audio_editor_preview&#x27;).is(&#x27;:visible&#x27;)) {
      component.find(&#x27;._current_time&#x27;).html(secondsToDateString(parsed_int));
      component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, parsed_int);
    }
  }
}

/**
Initializes two sliders: one (JQueryUi single slider) for the &lt;b&gt;cursor&lt;/b&gt;, and one (JQueryUi double slider) for the &lt;b&gt;cutting handles&lt;/b&gt;. It also initializes how to handle the event &lt;b&gt;ended&lt;/b&gt; associated to the audio.
@method initializeAudioEditorCutter
@for PlayersAudioEditor
@param identifier {Number} the unique identifier of the audio component (see {{#crossLinkModule &quot;audio-editor&quot;}}{{/crossLinkModule}})
**/
function initializeAudioEditorCutter(identifier) {
  var component = $(&#x27;#audio_component_&#x27; + identifier);
  var single_slider = component.find(&#x27;._media_player_slider&#x27;);
  var double_slider = component.find(&#x27;._double_slider&#x27;);
  var audio_max_to = component.data(&#x27;max-to&#x27;);
  var play = component.find(&#x27;._media_player_play_in_audio_editor_preview&#x27;);
  single_slider.slider({
    min: 0,
    max: audio_max_to,
    value: component.data(&#x27;from&#x27;),
    slide: function(event, ui) {
      if(play.is(&#x27;:visible&#x27;)) {
        component.find(&#x27;._current_time&#x27;).html(secondsToDateString(0));
        setCurrentTimeToMedia(component.find(&#x27;audio&#x27;), ui.value);
      }
    }
  });
  double_slider.slider({
    min: 0,
    max: audio_max_to,
    range: true,
    values: [component.data(&#x27;from&#x27;), component.data(&#x27;to&#x27;)],
    start: function(event, ui) {
      if($(ui.handle).next(&#x27;.ui-slider-handle&#x27;).length == 0) {
        selectAudioEditorRightHandle(identifier);
      } else {
        selectAudioEditorLeftHandle(identifier);
      }
    },
    slide: function(event, ui) {
      var left_val = ui.values[0];
      var right_val = ui.values[1];
      var cursor_val = component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;);
      if(left_val != component.data(&#x27;from&#x27;)) {
        if(cursor_val &lt; left_val) {
          selectAudioComponentCutterHandle(component, left_val);
        }
        component.find(&#x27;._cutter_from&#x27;).html(secondsToDateString(left_val));
      } else {
        if(cursor_val &gt; right_val) {
          selectAudioComponentCutterHandle(component, right_val);
        }
        component.find(&#x27;._cutter_to&#x27;).html(secondsToDateString(right_val));
      }
    },
    stop: function(event, ui) {
      var left_val = ui.values[0];
      var right_val = ui.values[1];
      if(left_val != component.data(&#x27;from&#x27;)) {
        if(left_val == right_val) {
          component.find(&#x27;._double_slider&#x27;).slider(&#x27;values&#x27;, 0, left_val - 1);
          left_val -= 1;
        }
        cutAudioComponentLeftSide(identifier, left_val);
      }
      if(right_val != component.data(&#x27;to&#x27;)) {
        if(left_val == right_val) {
          component.find(&#x27;._double_slider&#x27;).slider(&#x27;values&#x27;, 1, right_val + 1);
          right_val += 1;
        }
        cutAudioComponentRightSide(identifier, right_val);
      }
    }
  });
  double_slider.find(&#x27;.ui-slider-range&#x27;).mousedown(function(e) {
    return false;
  });
  initializeMediaTimeUpdaterInAudioEditor(identifier);
  component.find(&#x27;audio&#x27;).bind(&#x27;ended&#x27;, function() {
    if($(&#x27;#info_container&#x27;).data(&#x27;in-preview&#x27;)) {
      initializeActionOfMediaTimeUpdaterInAudioEditor(component.find(&#x27;audio&#x27;)[0], identifier, true);
    } else {
      try {
        var initial_time = component.data(&#x27;from&#x27;);
        component.find(&#x27;._media_player_pause_in_audio_editor_preview&#x27;).click();
        component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, initial_time);
        component.find(&#x27;._current_time&#x27;).html(secondsToDateString(initial_time));
        setCurrentTimeToMedia($(component.find(&#x27;audio&#x27;)), initial_time);
      } catch(err) {
        console.log(&#x27;error stopping media: &#x27; + err);
      }
    }
  });
}

/**
This is the method that associates {{#crossLink &quot;PlayersAudioEditor/initializeActionOfMediaTimeUpdaterInAudioEditor:method&quot;}}{{/crossLink}} to the event of &lt;b&gt;timeupdate&lt;/b&gt;. Notice that the method waits until he receives the event &lt;b&gt;loadedmetadata&lt;/b&gt; before working.
@method initializeMediaTimeUpdaterInAudioEditor
@for PlayersAudioEditor
@param identifier {Number} the unique identifier of the audio component (see {{#crossLinkModule &quot;audio-editor&quot;}}{{/crossLinkModule}})
**/
function initializeMediaTimeUpdaterInAudioEditor(identifier) {
  media = $(&#x27;#audio_component_&#x27; + identifier + &#x27; audio&#x27;);
  if(media.readyState != 0) {
    media[0].addEventListener(&#x27;timeupdate&#x27;, function() {
      initializeActionOfMediaTimeUpdaterInAudioEditor(this, identifier, false);
    }, false);
  } else {
    media.on(&#x27;loadedmetadata&#x27;, function() {
      media[0].addEventListener(&#x27;timeupdate&#x27;, function() {
        initializeActionOfMediaTimeUpdaterInAudioEditor(this, identifier, false);
      }, false);
    });
  }
}

/**
Method that &lt;b&gt;updates the audio cursor&lt;/b&gt;, in case one of the two handles passes over the cursor (the cursor must follow the handle).
@method selectAudioComponentCutterHandle
@for PlayersAudioEditor
@param component {Object} the JQuery object representing the component
@param val {Number} the value to be assigned
**/
function selectAudioComponentCutterHandle(component, val) {
  setCurrentTimeToMedia(component.find(&#x27;audio&#x27;), val);
  component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, val);
  component.find(&#x27;._current_time&#x27;).html(secondsToDateString(val));
}





/**
Method that logs all the possible events of a given media.
@method mediaEventsLogger
@for PlayersCommon
@param media {Object} the jquery object representing a &lt;b&gt;video&lt;/b&gt; or an &lt;b&gt;audio&lt;/b&gt; tag
**/
function mediaEventsLogger(media) {
  media.on(&#x27;loadstart&#x27;, function() {console.log(&#x27;loadstart&#x27;);});
  media.on(&#x27;progress&#x27;, function() {console.log(&#x27;progress&#x27;);});
  media.on(&#x27;suspend&#x27;, function() {console.log(&#x27;suspend&#x27;);});
  media.on(&#x27;abort&#x27;, function() {console.log(&#x27;abort&#x27;);});
  media.on(&#x27;error&#x27;, function() {console.log(&#x27;error&#x27;);});
  media.on(&#x27;emptied&#x27;, function() {console.log(&#x27;emptied&#x27;);});
  media.on(&#x27;stalled&#x27;, function() {console.log(&#x27;stalled&#x27;);});
  media.on(&#x27;loadedmetadata&#x27;, function() {console.log(&#x27;loadedmetadata&#x27;);});
  media.on(&#x27;loadeddata&#x27;, function() {console.log(&#x27;loadeddata&#x27;);});
  media.on(&#x27;canplay&#x27;, function() {console.log(&#x27;canplay&#x27;);});
  media.on(&#x27;canplaythrough&#x27;, function() {console.log(&#x27;canplaythrough&#x27;);});
  media.on(&#x27;playing&#x27;, function() {console.log(&#x27;playing&#x27;);});
  media.on(&#x27;waiting&#x27;, function() {console.log(&#x27;waiting&#x27;);});
  media.on(&#x27;seeking&#x27;, function() {console.log(&#x27;seeking&#x27;);});
  media.on(&#x27;seeked&#x27;, function() {console.log(&#x27;seeked&#x27;);});
  media.on(&#x27;ended&#x27;, function() {console.log(&#x27;ended&#x27;);});
  media.on(&#x27;durationchange&#x27;, function() {console.log(&#x27;durationchange&#x27;);});
  media.on(&#x27;timeupdate&#x27;, function() {console.log(&#x27;timeupdate&#x27;);});
  media.on(&#x27;play&#x27;, function() {console.log(&#x27;play&#x27;);});
  media.on(&#x27;pause&#x27;, function() {console.log(&#x27;pause&#x27;);});
  media.on(&#x27;ratechange&#x27;, function() {console.log(&#x27;ratechange&#x27;);});
  media.on(&#x27;volumechange&#x27;, function() {console.log(&#x27;volumechange&#x27;);});
}

/**
Sets a time to any media in any environment. Notice that the method waits until he receives the event &lt;b&gt;loadedmetadata&lt;/b&gt; before working.
@method setCurrentTimeToMedia
@for PlayersCommon
@param media {Object} the jquery object representing a &lt;b&gt;video&lt;/b&gt; or an &lt;b&gt;audio&lt;/b&gt; tag
@param seek {Float} the time to be set
**/
function setCurrentTimeToMedia(media, seek) {
  if(media[0].readyState != 0) {
    media[0].currentTime = validSeek(media, seek);
  } else {
    media.on(&#x27;loadedmetadata&#x27;, function() {
      media[0].currentTime = validSeek(media, seek);
    });
  }
}

/**
It shows an alert with error details, in case a media returned error.
@method showLoadingMediaErrorPopup
@for PlayersCommon
@param code {Number} the code associated to the error (it can be 1, 2, 3 or 4)
@param type {String} either &lt;b&gt;&#x27;audio&#x27;&lt;/b&gt; or &lt;b&gt;&#x27;video&#x27;&lt;/b&gt;
**/
function showLoadingMediaErrorPopup(code, type) {
  var captions = $captions;
  var message = captions.data(&#x27;media-error-code-&#x27; + code);
  var popup = captions.data(&#x27;media-error-&#x27; + type);
  popup = popup.replace(&#x27;%{code}&#x27;, &#x27;&#x27; + code);
  popup = popup.replace(&#x27;%{message}&#x27;, message);
  alert(popup);
}

/**
Stops all media in the page.
@method stopAllMedia
@for PlayersCommon
**/
function stopAllMedia() {
  $(&#x27;audio, video&#x27;).each(function() {
    stopMedia(this);
  });
}

/**
Submethod of {{#crossLink &quot;PlayersCommon/setCurrentTimeToMedia:method&quot;}}{{/crossLink}}, used because some browsers (Internet Explorer for instance), get broken if the value of seek is not included in the &lt;b&gt;seekable interval&lt;/b&gt;.
@method validSeek
@for PlayersCommon
@param media {Object} the jquery object representing a &lt;b&gt;video&lt;/b&gt; or an &lt;b&gt;audio&lt;/b&gt; tag
@param seek {Float} the value to be assigned to the media
**/
function validSeek(media, seek) {
  var confidence = 0.001;
  var minStart = media[0].seekable.start(0);
  var maxEnd = media[0].seekable.end(0);
  if (seek &lt; minStart) {
    seek = minStart + confidence;
  } else if (seek &gt; maxEnd) {
    seek = maxEnd - confidence;
  }
  return seek;
}





/**
Initializer for buttons inside a cutter in {{#crossLinkModule &quot;audio-editor&quot;}}{{/crossLinkModule}}.
@method playersDocumentReadyAudioEditor
@for PlayersDocumentReady
**/
function playersDocumentReadyAudioEditor() {
  $body.on(&#x27;click&#x27;, &#x27;._media_player_play_in_audio_editor_preview&#x27;, function() {
    var component = $(this).parents(&#x27;._audio_editor_component&#x27;);
    var identifier = getAudioComponentIdentifier(component);
    var audio = component.find(&#x27;audio&#x27;);
    if(audio[0].error) {
      showLoadingMediaErrorPopup(audio[0].error.code, &#x27;audio&#x27;);
    } else {
      $(this).hide();
      $(&#x27;#start_audio_editor_preview&#x27;).addClass(&#x27;disabled&#x27;);
      $(&#x27;#rewind_audio_editor_preview&#x27;).addClass(&#x27;disabled&#x27;);
      component.data(&#x27;playing&#x27;, true);
      component.find(&#x27;._media_player_slider_disabler&#x27;).show();
      component.find(&#x27;._media_player_rewind_in_audio_editor_preview&#x27;).hide();
      component.find(&#x27;._media_player_pause_in_audio_editor_preview&#x27;).show();
      deselectAllAudioEditorCursors(identifier);
      var single_slider = component.find(&#x27;._media_player_slider&#x27;);
      if(audio[0].currentTime &lt; single_slider.slider(&#x27;value&#x27;)) {
        setCurrentTimeToMedia(audio, single_slider.slider(&#x27;value&#x27;));
      }
      audio[0].play();
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;._media_player_pause_in_audio_editor_preview&#x27;, function() {
    $(this).hide();
    $(&#x27;#start_audio_editor_preview&#x27;).removeClass(&#x27;disabled&#x27;);
    $(&#x27;#rewind_audio_editor_preview&#x27;).removeClass(&#x27;disabled&#x27;);
    var component = $(this).parents(&#x27;._audio_editor_component&#x27;);
    var identifier = getAudioComponentIdentifier(component);
    component.data(&#x27;playing&#x27;, false);
    component.find(&#x27;._media_player_slider_disabler&#x27;).hide();
    component.find(&#x27;._media_player_rewind_in_audio_editor_preview&#x27;).show();
    component.find(&#x27;._media_player_play_in_audio_editor_preview&#x27;).show();
    selectAudioEditorCursor(identifier);
    component.find(&#x27;audio&#x27;)[0].pause();
    if(component.data(&#x27;to&#x27;) != parseInt(component.find(&#x27;audio&#x27;)[0].currentTime)) {
      setCurrentTimeToMedia(component.find(&#x27;audio&#x27;), component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;));
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;._media_player_rewind_in_audio_editor_preview&#x27;, function() {
    var component = $(this).parents(&#x27;._audio_editor_component&#x27;);
    var initial_time = component.data(&#x27;from&#x27;);
    component.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, initial_time);
    setCurrentTimeToMedia(component.find(&#x27;audio&#x27;), initial_time);
    component.find(&#x27;._current_time&#x27;).html(secondsToDateString(initial_time));
  });
  $body.on(&#x27;click&#x27;, &#x27;._audio_editor_component ._double_slider .ui-slider-range&#x27;, function(e) {
    var component = $(this).parents(&#x27;._audio_editor_component&#x27;);
    var identifier = getAudioComponentIdentifier(component);
    var percent = component.data(&#x27;max-to&#x27;) * (e.pageX - component.find(&#x27;._double_slider&#x27;).offset().left) / component.find(&#x27;._double_slider&#x27;).width();
    resp = parseInt(percent);
    if(percent - parseInt(percent) &gt; 0.5) {
      resp += 1;
    }
    selectAudioEditorCursor(identifier);
    selectAudioComponentCutterHandle(component, resp);
  });
}

/**
Initializer for buttons inside any player.
@method playersDocumentReadyGeneral
@for PlayersDocumentReady
**/
function playersDocumentReadyGeneral() {
  $body.on(&#x27;click&#x27;, &#x27;._media_player_play&#x27;, function() {
    var container_id = $(this).parent().attr(&#x27;id&#x27;);
    var type = $(this).parent().data(&#x27;media-type&#x27;);
    var media = $(&#x27;#&#x27; + container_id + &#x27; &#x27; + type);
    if(media[0].error) {
      showLoadingMediaErrorPopup(media[0].error.code, type);
    } else {
      $(&#x27;#&#x27; + container_id + &#x27; ._media_player_slider_disabler&#x27;).show();
      $(&#x27;#&#x27; + container_id + &#x27; ._media_player_pause&#x27;).show();
      $(this).hide();
      media[0].play();
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;._media_player_pause&#x27;, function() {
    $(this).hide();
    var container_id = $(this).parent().attr(&#x27;id&#x27;);
    var type = $(this).parent().data(&#x27;media-type&#x27;);
    $(&#x27;#&#x27; + container_id + &#x27; ._media_player_slider_disabler&#x27;).hide();
    $(&#x27;#&#x27; + container_id + &#x27; ._media_player_play&#x27;).show();
    $(&#x27;#&#x27; + container_id + &#x27; &#x27; + type)[0].pause();
  });
  $body.on(&#x27;click&#x27;, &#x27;._video_full_screen&#x27;, function() {
    var container_id = $(this).parent().attr(&#x27;id&#x27;);
    $(&#x27;#&#x27; + container_id + &#x27; video&#x27;).fullScreen(true);
  });
}

/**
Initializer for buttons inside a cutter in {{#crossLinkModule &quot;video-editor&quot;}}{{/crossLinkModule}}.
@method playersDocumentReadyVideoEditor
@for PlayersDocumentReady
**/
function playersDocumentReadyVideoEditor() {
  $body.on(&#x27;click&#x27;, &#x27;._media_player_play_in_video_editor_preview&#x27;, function() {
    var identifier = getVideoComponentIdentifier($(this).parents(&#x27;._video_component_cutter&#x27;).attr(&#x27;id&#x27;));
    var video = $(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;);
    if(video[0].error){
      showLoadingMediaErrorPopup(video[0].error.code, &#x27;video&#x27;);
    } else {
      $(this).hide();
      $(this).parents(&#x27;._video_component_cutter&#x27;).data(&#x27;playing&#x27;, true);
      $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_rewind_in_video_editor_preview&#x27;).hide();
      $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_slider_disabler&#x27;).show();
      $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_pause_in_video_editor_preview&#x27;).show();
      $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter .ui-slider-handle&#x27;).removeClass(&#x27;selected&#x27;);
      video[0].play();
    }
    var actual_audio_track_time = calculateVideoComponentStartSecondInVideoEditor(identifier);
    if(videoEditorWithAudioTrack() &amp;&amp; actual_audio_track_time &lt; $(&#x27;#full_audio_track_placeholder_in_video_editor&#x27;).data(&#x27;duration&#x27;)) {
      var audio_track = $(&#x27;#video_editor_preview_container audio&#x27;);
      if(audio_track[0].error) {
        showLoadingMediaErrorPopup(audio_track[0].error.code, &#x27;audio&#x27;);
      } else {
        setCurrentTimeToMedia(audio_track, actual_audio_track_time);
        audio_track[0].play();
      }
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;._media_player_pause_in_video_editor_preview&#x27;, function() {
    $(this).hide();
    $(this).parents(&#x27;._video_component_cutter&#x27;).data(&#x27;playing&#x27;, false);
    var cutter_id = $(this).parents(&#x27;._video_component_cutter&#x27;).attr(&#x27;id&#x27;);
    var preview_id = cutter_id.replace(&#x27;cutter&#x27;, &#x27;preview&#x27;);
    $(&#x27;#&#x27; + cutter_id + &#x27; ._media_player_rewind_in_video_editor_preview&#x27;).show();
    $(&#x27;#&#x27; + cutter_id + &#x27; ._media_player_slider_disabler&#x27;).hide();
    $(&#x27;#&#x27; + cutter_id + &#x27; ._media_player_play_in_video_editor_preview&#x27;).show();
    $(&#x27;#&#x27; + cutter_id + &#x27; ._media_player_slider .ui-slider-handle&#x27;).addClass(&#x27;selected&#x27;);
    $(&#x27;#&#x27; + preview_id + &#x27; video&#x27;)[0].pause();
    if(videoEditorWithAudioTrack()) {
      $(&#x27;#video_editor_preview_container audio&#x27;)[0].pause();
    }
    if(parseInt($(&#x27;#&#x27; + preview_id + &#x27; video&#x27;)[0].currentTime) != $(&#x27;#&#x27; + cutter_id).data(&#x27;to&#x27;)) {
      setCurrentTimeToMedia($(&#x27;#&#x27; + preview_id + &#x27; video&#x27;), $(&#x27;#&#x27; + cutter_id + &#x27; ._media_player_slider&#x27;).slider(&#x27;value&#x27;));
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;._media_player_rewind_in_video_editor_preview&#x27;, function() {
    var identifier = getVideoComponentIdentifier($(this).parents(&#x27;._video_component_cutter&#x27;).attr(&#x27;id&#x27;));
    var initial_time = $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter&#x27;).data(&#x27;from&#x27;);
    $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_slider&#x27;).slider(&#x27;value&#x27;, initial_time);
    setCurrentTimeToMedia($(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;), initial_time);
  });
  $body.on(&#x27;click&#x27;, &#x27;._video_component_cutter ._double_slider .ui-slider-range&#x27;, function(e) {
    var cutter = $(this).parents(&#x27;._video_component_cutter&#x27;);
    var percent = cutter.data(&#x27;max-to&#x27;) * (e.pageX - cutter.find(&#x27;._double_slider&#x27;).offset().left) / cutter.find(&#x27;._double_slider&#x27;).width();
    resp = parseInt(percent);
    if(percent - parseInt(percent) &gt; 0.5) {
      resp += 1;
    }
    cutter.find(&#x27;.ui-slider-handle&#x27;).removeClass(&#x27;selected&#x27;);
    cutter.find(&#x27;._media_player_slider .ui-slider-handle&#x27;).addClass(&#x27;selected&#x27;);
    selectVideoComponentCutterHandle(cutter, resp);
  });
}





/**
Method that handles the event &lt;b&gt;timeupdate&lt;/b&gt; for general audio or video players: if we got to the last second, the method rewinds the media, otherwise sets the time to the slider (this happens even if the slider already had that value, unlike the methods {{#crossLink &quot;PlayersAudioEditor/initializeActionOfMediaTimeUpdaterInAudioEditor:method&quot;}}{{/crossLink}} and {{#crossLink &quot;PlayersVideoEditor/initializeActionOfMediaTimeUpdaterInVideoEditor:method&quot;}}{{/crossLink}} during &lt;b&gt;preview mode&lt;/b&gt;).
@method initializeActionOfMediaTimeUpdater
@for PlayersGeneral
@param media {String} HTML selector for the audio or video
@param reference_id {String} HTML id of the unique container of the audio or video
**/
function initializeActionOfMediaTimeUpdater(media, reference_id) {
  var duration = $(&#x27;#&#x27; + reference_id).data(&#x27;duration&#x27;);
  var container_id = $(media).parent().attr(&#x27;id&#x27;);
  var parsed_int = parseInt(media.currentTime);
  if(parsed_int == (duration)) {
    $(&#x27;#&#x27; + container_id + &#x27; ._media_player_pause&#x27;).click();
    $(&#x27;#&#x27; + container_id + &#x27; ._media_player_slider&#x27;).slider(&#x27;value&#x27;, 0);
    $(&#x27;#&#x27; + container_id + &#x27; ._media_player_current_time&#x27;).html(secondsToDateString(0));
    setCurrentTimeToMedia($(media), 0);
  } else if(!$(&#x27;#&#x27; + container_id + &#x27; ._media_player_play&#x27;).is(&#x27;:visible&#x27;)) {
    $(&#x27;#&#x27; + container_id + &#x27; ._media_player_current_time&#x27;).html(secondsToDateString(parsed_int));
    $(&#x27;#&#x27; + container_id + &#x27; ._media_player_slider&#x27;).slider(&#x27;value&#x27;, parsed_int);
  }
}

/**
Initializes the media player for a generic audio or video.
@method initializeMedia
@for PlayersGeneral
@param content_id {String} the HTML id of the unique container of the media
@param type {String} it can be either &lt;b&gt;&#x27;audio&#x27;&lt;/b&gt; or &lt;b&gt;&#x27;video&#x27;&lt;/b&gt;
**/
function initializeMedia(content_id, type) {
  var duration = $(&#x27;#&#x27; + content_id).data(&#x27;duration&#x27;);
  $(&#x27;#&#x27; + content_id + &#x27; ._media_player_slider&#x27;).slider({
    min: 0,
    max: duration,
    range: &#x27;min&#x27;,
    value: 0,
    slide: function(event, ui) {
      if($(&#x27;#&#x27; + content_id + &#x27; ._media_player_play&#x27;).is(&#x27;:visible&#x27;)) {
        setCurrentTimeToMedia($(&#x27;#&#x27; + content_id + &#x27; &#x27; + type), ui.value);
        $(&#x27;#&#x27; + content_id + &#x27; ._media_player_current_time&#x27;).html(secondsToDateString(ui.value));
      }
    }
  });
  initializeMediaTimeUpdater(&#x27;#&#x27; + content_id + &#x27; &#x27; + type, content_id);
  $(&#x27;#&#x27; + content_id + &#x27; &#x27; + type).bind(&#x27;ended&#x27;, function() {
    stopMedia(this);
  });
  $(&#x27;#&#x27; + content_id).data(&#x27;initialized&#x27;, true);
}

/**
This is the method that associates {{#crossLink &quot;PlayersGeneral/initializeActionOfMediaTimeUpdater:method&quot;}}{{/crossLink}} to the event of &lt;b&gt;timeupdate&lt;/b&gt;. Notice that the method waits until he receives the event &lt;b&gt;loadedmetadata&lt;/b&gt; before working.
@method initializeMediaTimeUpdater
@for PlayersGeneral
@param media {String} HTML selector for the audio or video
@param reference_id {String} HTML id of the unique container of the audio or video
**/
function initializeMediaTimeUpdater(media, reference_id) {
  media = $(media);
  if(media.readyState != 0) {
    media[0].addEventListener(&#x27;timeupdate&#x27;, function() {
      initializeActionOfMediaTimeUpdater(this, reference_id);
    }, false);
  } else {
    media.on(&#x27;loadedmetadata&#x27;, function() {
      media[0].addEventListener(&#x27;timeupdate&#x27;, function() {
        initializeActionOfMediaTimeUpdater(this, reference_id);
      }, false);
    });
  }
}

/**
Stops a generic media, logging errors in the console.
@method stopMedia
@for PlayersGeneral
@param media {String} HTML selector for the audio or video
**/
function stopMedia(media) {
  try {
    if($(media).length != 0) {
      var has_source = false;
      $(media).find(&#x27;source&#x27;).each(function() {
        if($(this).attr(&#x27;src&#x27;) != &#x27;&#x27;) {
          has_source = true;
        }
      });
      if(has_source) {
        var container_id = $(media).parent().attr(&#x27;id&#x27;);
        $(&#x27;#&#x27; + container_id + &#x27; ._media_player_pause&#x27;).click();
        $(&#x27;#&#x27; + container_id + &#x27; ._media_player_slider&#x27;).slider(&#x27;value&#x27;, 0);
        $(&#x27;#&#x27; + container_id + &#x27; ._media_player_current_time&#x27;).html(secondsToDateString(0));
        setCurrentTimeToMedia($(media), 0);
      }
    }
  } catch(err) {
    console.log(&#x27;error stopping media: &#x27; + err);
  }
}





/**
This method has the same cases of use of {{#crossLink &quot;PlayersAudioEditor/initializeActionOfMediaTimeUpdaterInAudioEditor:method&quot;}}{{/crossLink}}, with a couple of details more due to the more complicated environment present in {{#crossLinkModule &quot;video-editor&quot;}}{{/crossLinkModule}}:
&lt;ul&gt;
  &lt;li&gt;the passage from a component to another (the method called in this case is {{#crossLink &quot;VideoEditorPreview/playVideoEditorComponent:method&quot;}}{{/crossLink}}) must handle a &lt;b&gt;transition&lt;/b&gt; of one second&lt;/li&gt;
  &lt;li&gt;it&#x27;s necessary to hide and show the preview &lt;b&gt;progress bar&lt;/b&gt; (see {{#crossLink &quot;VideoEditorPreviewAccessories/showVideoEditorPreviewComponentProgressBar:method&quot;}}{{/crossLink}}) positioning it with the help of the methods in {{#crossLink &quot;MediaElementEditorHorizontalTimelines&quot;}}{{/crossLink}}&lt;/li&gt;
  &lt;li&gt;the method needs also to update the &lt;b&gt;background audio track&lt;/b&gt;, but only if it&#x27;s present and if the &lt;b&gt;global preview time&lt;/b&gt; is not greater than its duration.&lt;/li&gt;
&lt;/ul&gt;
@method initializeActionOfMediaTimeUpdaterInVideoEditor
@for PlayersVideoEditor
@param media {String} HTML selector for the video
@param identifier {Number} unique identifier for the video component (see {{#crossLinkModule &quot;video-editor&quot;}}{{/crossLinkModule}})
@param force_parsed_int {Boolean} forces the last second of the video; normally it&#x27;s &lt;i&gt;false&lt;/i&gt;, except the case in which the duration of the video is very close to the biggest lower integer (for instance, the duration is 10.01, which is very close to 10): in this case, the signal that the video ended &lt;b&gt;is not received directly by the current method&lt;/b&gt;, but rather by the event handler &lt;b&gt;ended&lt;/b&gt; initialized in the end of {{#crossLink &quot;PlayersVideoEditor/initializeVideoInVideoEditorPreview:method&quot;}}{{/crossLink}}
**/
function initializeActionOfMediaTimeUpdaterInVideoEditor(media, identifier, force_parsed_int) {
  var video_cut_to = $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter&#x27;).data(&#x27;to&#x27;);
  var not_parsed_int = media.currentTime;
  var parsed_int = parseInt(not_parsed_int);
  if(force_parsed_int || (not_parsed_int &lt; video_cut_to &amp;&amp; (video_cut_to - not_parsed_int) &lt;= 0.2)) {
    parsed_int = video_cut_to;
    $(media).data(&#x27;dont-update-time&#x27;, true);
    setCurrentTimeToMedia($(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;), video_cut_to);
  }
  if($(&#x27;#video_editor_global_preview&#x27;).data(&#x27;in-use&#x27;)) {
    var component = $(&#x27;#video_component_&#x27; + identifier);
    if(parsed_int &gt; component.data(&#x27;current-preview-time&#x27;) + $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter&#x27;).data(&#x27;from&#x27;)) {
      if(parsed_int == video_cut_to) {
        $(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;)[0].pause();
        var next_component = component.next();
        var next_identifier = getVideoComponentIdentifier(next_component.attr(&#x27;id&#x27;));
        if(next_component.hasClass(&#x27;_video_editor_component&#x27;)) {
          increaseVideoEditorPreviewTimer(true);
          $(&#x27;#video_editor_global_preview&#x27;).data(&#x27;current-component&#x27;, next_identifier);
          $(&#x27;#video_component_&#x27; + identifier + &#x27;_preview&#x27;).hide(&#x27;fade&#x27;, {}, 1000);
          component.find(&#x27;._video_component_transition&#x27;).removeClass(&#x27;current&#x27;);
          next_component.find(&#x27;._video_editor_component_hover, ._video_component_icon&#x27;).removeClass(&#x27;selected&#x27;);
          $(&#x27;#video_component_&#x27; + next_identifier + &#x27;_preview&#x27;).show(&#x27;fade&#x27;, {}, 1000, function() {
            hideVideoEditorPreviewComponentProgressBar();
            setCurrentTimeToMedia($(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;), $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter&#x27;).data(&#x27;from&#x27;));
            $(&#x27;#video_component_&#x27; + identifier + &#x27; ._video_component_icon ._right&#x27;).html(secondsToDateString(0));
            if(!$(&#x27;#video_editor_global_preview&#x27;).data(&#x27;in-use&#x27;)) {
              $(&#x27;._video_component_transition&#x27;).addClass(&#x27;current&#x27;);
            }
            increaseVideoEditorPreviewTimer(false);
            component.find(&#x27;._video_editor_component_hover, ._video_component_icon&#x27;).addClass(&#x27;selected&#x27;);
            if($(&#x27;#video_editor_global_preview&#x27;).data(&#x27;in-use&#x27;)) {
              playVideoEditorComponent(next_component, true);
            } else {
              var how_many_hidden_to_left = getHowManyComponentsHiddenToLeftTimelineHorizontalScrollPane(&#x27;media_elements_list_in_video_editor&#x27;, 186);
              showVideoEditorPreviewComponentProgressBar(next_identifier, next_component.data(&#x27;position&#x27;) - how_many_hidden_to_left);
            }
          });
        } else {
          var first_component = getFirstVideoEditorComponent();
          selectVideoComponentInPreview(first_component);
          hideVideoEditorPreviewComponentProgressBar();
          if(videoEditorWithAudioTrack()) {
            $(&#x27;#video_editor_preview_container audio&#x27;)[0].pause();
          }
          $(&#x27;#video_editor_global_preview_pause&#x27;).trigger(&#x27;click&#x27;);
          if($(&#x27;._video_editor_component&#x27;).length &gt; 5) {
            $(&#x27;#media_elements_list_in_video_editor&#x27;).jScrollPane().bind(&#x27;panescrollstop&#x27;, function() {
              showVideoEditorPreviewComponentProgressBar(getVideoComponentIdentifier(first_component.attr(&#x27;id&#x27;)), 1);
              $(&#x27;#media_elements_list_in_video_editor&#x27;).jScrollPane().unbind(&#x27;panescrollstop&#x27;);
            });
            $(&#x27;#media_elements_list_in_video_editor&#x27;).data(&#x27;jsp&#x27;).scrollToX(0, true, 500);
          } else {
            showVideoEditorPreviewComponentProgressBar(getVideoComponentIdentifier(first_component.attr(&#x27;id&#x27;)), 1);
          }
        }
      } else {
        increaseVideoEditorPreviewTimer(true);
      }
    }
  } else if($(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter&#x27;).data(&#x27;playing&#x27;)) {
    if(parsed_int == (video_cut_to)) {
      var initial_time = $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter&#x27;).data(&#x27;from&#x27;);
      $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_pause_in_video_editor_preview&#x27;).click();
      $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_slider&#x27;).slider(&#x27;value&#x27;, initial_time);
      setCurrentTimeToMedia($(media), initial_time);
    } else if(!$(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_play_in_video_editor_preview&#x27;).is(&#x27;:visible&#x27;)) {
      $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_slider&#x27;).slider(&#x27;value&#x27;, parsed_int);
    }
  }
  $(media).data(&#x27;dont-update-time&#x27;, false);
}

/**
This is the method that associates {{#crossLink &quot;PlayersVideoEditor/initializeActionOfMediaTimeUpdaterInVideoEditor:method&quot;}}{{/crossLink}} to the event of &lt;b&gt;timeupdate&lt;/b&gt;. Notice that the method waits until he receives the event &lt;b&gt;loadedmetadata&lt;/b&gt; before working.
@method initializeMediaTimeUpdaterInVideoEditor
@for PlayersVideoEditor
@param media {String} HTML selector for the audio or video
@param identifier {Number} unique identifier of a video component (see {{#crossLinkModule &quot;video-editor&quot;}}{{/crossLinkModule}})
**/
function initializeMediaTimeUpdaterInVideoEditor(media, identifier) {
  media = $(media);
  if(media.readyState != 0) {
    media[0].addEventListener(&#x27;timeupdate&#x27;, function() {
      if(!$(media).data(&#x27;dont-update-time&#x27;)) {
        initializeActionOfMediaTimeUpdaterInVideoEditor(this, identifier, false);
      }
    }, false);
  } else {
    media.on(&#x27;loadedmetadata&#x27;, function() {
      media[0].addEventListener(&#x27;timeupdate&#x27;, function() {
        if(!$(media).data(&#x27;dont-update-time&#x27;)) {
          initializeActionOfMediaTimeUpdaterInVideoEditor(this, identifier, false);
        }
      }, false);
    });
  }
}

/**
Initializes two sliders: one (JQueryUi single slider) for the &lt;b&gt;cursor&lt;/b&gt;, and one (JQueryUi double slider) for the &lt;b&gt;cutting handles&lt;/b&gt;. It also initializes how to handle the event &lt;b&gt;ended&lt;/b&gt; associated to the video.
@method initializeVideoInVideoEditorPreview
@for PlayersVideoEditor
@param identifier {Number} the unique identifier of the video component (see {{#crossLinkModule &quot;video-editor&quot;}}{{/crossLinkModule}})
**/
function initializeVideoInVideoEditorPreview(identifier) {
  var my_cutter = $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter&#x27;);
  $(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;).on(&#x27;loadeddata&#x27;, function() {
    setCurrentTimeToMedia($(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;), my_cutter.data(&#x27;from&#x27;));
  });
  var video_max_to = my_cutter.data(&#x27;max-to&#x27;);
  my_cutter.find(&#x27;._media_player_slider&#x27;).slider({
    min: 0,
    max: video_max_to,
    value: my_cutter.data(&#x27;from&#x27;),
    slide: function(event, ui) {
      if(my_cutter.find(&#x27;._media_player_play_in_video_editor_preview&#x27;).is(&#x27;:visible&#x27;)) {
        setCurrentTimeToMedia($(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;), ui.value);
      }
    }
  });
  my_cutter.find(&#x27;._double_slider&#x27;).slider({
    min: 0,
    max: video_max_to,
    range: true,
    values: [my_cutter.data(&#x27;from&#x27;), my_cutter.data(&#x27;to&#x27;)],
    start: function(event, ui) {
      my_cutter.find(&#x27;.ui-slider-handle&#x27;).removeClass(&#x27;selected&#x27;);
      $(ui.handle).addClass(&#x27;selected&#x27;);
    },
    slide: function(event, ui) {
      var left_val = ui.values[0];
      var right_val = ui.values[1];
      var cursor_val = my_cutter.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;);
      if(left_val != my_cutter.data(&#x27;from&#x27;)) {
        if(cursor_val &lt; left_val) {
          selectVideoComponentCutterHandle(my_cutter, left_val);
        }
      } else {
        if(cursor_val &gt; right_val) {
          selectVideoComponentCutterHandle(my_cutter, right_val);
        }
      }
    },
    stop: function(event, ui) {
      my_cutter.data(&#x27;changed&#x27;, true);
      var left_val = ui.values[0];
      var right_val = ui.values[1];
      if(left_val != my_cutter.data(&#x27;from&#x27;)) {
        if(left_val == right_val) {
          my_cutter.find(&#x27;._double_slider&#x27;).slider(&#x27;values&#x27;, 0, left_val - 1);
          left_val -= 1;
        }
        cutVideoComponentLeftSide(identifier, left_val);
      }
      if(right_val != my_cutter.data(&#x27;to&#x27;)) {
        if(left_val == right_val) {
          my_cutter.find(&#x27;._double_slider&#x27;).slider(&#x27;values&#x27;, 1, right_val + 1);
          right_val += 1;
        }
        cutVideoComponentRightSide(identifier, right_val);
      }
    }
  });
  my_cutter.find(&#x27;._double_slider .ui-slider-range&#x27;).mousedown(function(e) {
    return false;
  });
  $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_slider .ui-slider-handle&#x27;).addClass(&#x27;selected&#x27;);
  initializeMediaTimeUpdaterInVideoEditor(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;, identifier);
  $(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;).bind(&#x27;ended&#x27;, function() {
    if($(&#x27;#video_editor_global_preview&#x27;).data(&#x27;in-use&#x27;)) {
      initializeActionOfMediaTimeUpdaterInVideoEditor($(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;)[0], identifier, true);
    } else {
      stopVideoInVideoEditorPreview(identifier);
    }
  });
}

/**
Method that &lt;b&gt;updates the video cursor&lt;/b&gt;, in case one of the two handles passes over the cursor (the cursor must follow the handle).
@method selectVideoComponentCutterHandle
@for PlayersVideoEditor
@param cutter {Object} the JQuery object representing the cutter for that particular component (see {{#crossLinkModule &quot;video-editor&quot;}}{{/crossLinkModule}})
@param val {Number} the value to be assigned
**/
function selectVideoComponentCutterHandle(cutter, val) {
  setCurrentTimeToMedia($(&#x27;#&#x27; + cutter.attr(&#x27;id&#x27;).replace(&#x27;cutter&#x27;, &#x27;preview&#x27;) + &#x27; video&#x27;), val);
  cutter.find(&#x27;._media_player_slider&#x27;).slider(&#x27;value&#x27;, val);
}

/**
Specific method to call if the event &lt;b&gt;ended&lt;/b&gt; is fired on the video and we are not in the {{#crossLinkModule &quot;video-editor&quot;}}{{/crossLinkModule}} preview mode (unlike in {{#crossLink &quot;PlayersAudioEditor&quot;}}{{/crossLink}}, in this case it&#x27;s separated by the method {{#crossLink &quot;PlayersVideoEditor/initializeVideoInVideoEditorPreview:method&quot;}}{{/crossLink}}, since it&#x27;s more complicated.
@method stopVideoInVideoEditorPreview
@for PlayersVideoEditor
@param identifier {Number} the unique identifier of the video component
**/
function stopVideoInVideoEditorPreview(identifier) {
  try {
    if($(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;).length != 0) {
      var has_source = true;
      $(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;).find(&#x27;source&#x27;).each(function() {
        if($(this).attr(&#x27;src&#x27;) == &#x27;&#x27;) {
          has_source = false;
        }
      });
      if(has_source) {
        $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_pause_in_video_editor_preview&#x27;).click();
        var initial_time = $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter&#x27;).data(&#x27;from&#x27;);
        $(&#x27;#video_component_&#x27; + identifier + &#x27;_cutter ._media_player_slider&#x27;).slider(&#x27;value&#x27;, initial_time);
        setCurrentTimeToMedia($(&#x27;#video_component_&#x27; + identifier + &#x27;_preview video&#x27;), initial_time);
      }
    }
  } catch(err) {
    console.log(&#x27;error stopping media: &#x27; + err);
  }
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
