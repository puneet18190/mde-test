<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/assets/javascripts/admin/functions.js - DESY</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="DESY"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdminAutocomplete.html">AdminAutocomplete</a></li>
            
                <li><a href="../classes/AdminBrowserSupport.html">AdminBrowserSupport</a></li>
            
                <li><a href="../classes/AdminCollapsed.html">AdminCollapsed</a></li>
            
                <li><a href="../classes/AdminDocumentReady.html">AdminDocumentReady</a></li>
            
                <li><a href="../classes/AjaxLoaderBinder.html">AjaxLoaderBinder</a></li>
            
                <li><a href="../classes/AjaxLoaderDocumentReady.html">AjaxLoaderDocumentReady</a></li>
            
                <li><a href="../classes/AjaxLoaderVisibility.html">AjaxLoaderVisibility</a></li>
            
                <li><a href="../classes/AudioEditorComponents.html">AudioEditorComponents</a></li>
            
                <li><a href="../classes/AudioEditorCutters.html">AudioEditorCutters</a></li>
            
                <li><a href="../classes/AudioEditorDocumentReady.html">AudioEditorDocumentReady</a></li>
            
                <li><a href="../classes/AudioEditorGalleries.html">AudioEditorGalleries</a></li>
            
                <li><a href="../classes/AudioEditorGeneral.html">AudioEditorGeneral</a></li>
            
                <li><a href="../classes/AudioEditorGraphics.html">AudioEditorGraphics</a></li>
            
                <li><a href="../classes/AudioEditorPreview.html">AudioEditorPreview</a></li>
            
                <li><a href="../classes/AudioEditorScrollpain.html">AudioEditorScrollpain</a></li>
            
                <li><a href="../classes/BrowserSupportMain.html">BrowserSupportMain</a></li>
            
                <li><a href="../classes/ButtonsAccessories.html">ButtonsAccessories</a></li>
            
                <li><a href="../classes/ButtonsDocumentReady.html">ButtonsDocumentReady</a></li>
            
                <li><a href="../classes/ButtonsLesson.html">ButtonsLesson</a></li>
            
                <li><a href="../classes/ButtonsMediaElement.html">ButtonsMediaElement</a></li>
            
                <li><a href="../classes/DashboardAccessories.html">DashboardAccessories</a></li>
            
                <li><a href="../classes/DashboardExpandedContents.html">DashboardExpandedContents</a></li>
            
                <li><a href="../classes/DashboardLessonDescriptions.html">DashboardLessonDescriptions</a></li>
            
                <li><a href="../classes/DashboardResizing.html">DashboardResizing</a></li>
            
                <li><a href="../classes/DialogsAccessories.html">DialogsAccessories</a></li>
            
                <li><a href="../classes/DialogsConfirmation.html">DialogsConfirmation</a></li>
            
                <li><a href="../classes/DialogsGalleries.html">DialogsGalleries</a></li>
            
                <li><a href="../classes/DialogsTimed.html">DialogsTimed</a></li>
            
                <li><a href="../classes/DialogsWithForm.html">DialogsWithForm</a></li>
            
                <li><a href="../classes/GalleriesAccessories.html">GalleriesAccessories</a></li>
            
                <li><a href="../classes/GalleriesDocumentReady.html">GalleriesDocumentReady</a></li>
            
                <li><a href="../classes/GalleriesInitializers.html">GalleriesInitializers</a></li>
            
                <li><a href="../classes/GeneralCentering.html">GeneralCentering</a></li>
            
                <li><a href="../classes/GeneralDocumentReady.html">GeneralDocumentReady</a></li>
            
                <li><a href="../classes/GeneralMiscellanea.html">GeneralMiscellanea</a></li>
            
                <li><a href="../classes/GeneralUrls.html">GeneralUrls</a></li>
            
                <li><a href="../classes/ImageEditorDocumentReady.html">ImageEditorDocumentReady</a></li>
            
                <li><a href="../classes/ImageEditorGraphics.html">ImageEditorGraphics</a></li>
            
                <li><a href="../classes/ImageEditorImageScale.html">ImageEditorImageScale</a></li>
            
                <li><a href="../classes/ImageEditorTexts.html">ImageEditorTexts</a></li>
            
                <li><a href="../classes/JqueryBrowsersDetection.html">JqueryBrowsersDetection</a></li>
            
                <li><a href="../classes/JqueryPatchesBrowsers.html">JqueryPatchesBrowsers</a></li>
            
                <li><a href="../classes/LessonEditorCurrentSlide.html">LessonEditorCurrentSlide</a></li>
            
                <li><a href="../classes/LessonEditorDocumentReady.html">LessonEditorDocumentReady</a></li>
            
                <li><a href="../classes/LessonEditorForms.html">LessonEditorForms</a></li>
            
                <li><a href="../classes/LessonEditorGalleries.html">LessonEditorGalleries</a></li>
            
                <li><a href="../classes/LessonEditorImageResizing.html">LessonEditorImageResizing</a></li>
            
                <li><a href="../classes/LessonEditorJqueryAnimations.html">LessonEditorJqueryAnimations</a></li>
            
                <li><a href="../classes/LessonEditorSlideLoading.html">LessonEditorSlideLoading</a></li>
            
                <li><a href="../classes/LessonEditorSlidesNavigation.html">LessonEditorSlidesNavigation</a></li>
            
                <li><a href="../classes/LessonEditorTinyMCE.html">LessonEditorTinyMCE</a></li>
            
                <li><a href="../classes/LessonViewerDocumentReady.html">LessonViewerDocumentReady</a></li>
            
                <li><a href="../classes/LessonViewerGeneral.html">LessonViewerGeneral</a></li>
            
                <li><a href="../classes/LessonViewerGraphics.html">LessonViewerGraphics</a></li>
            
                <li><a href="../classes/LessonViewerPlaylist.html">LessonViewerPlaylist</a></li>
            
                <li><a href="../classes/LessonViewerSlidesNavigation.html">LessonViewerSlidesNavigation</a></li>
            
                <li><a href="../classes/MediaElementEditorCache.html">MediaElementEditorCache</a></li>
            
                <li><a href="../classes/MediaElementEditorConversion.html">MediaElementEditorConversion</a></li>
            
                <li><a href="../classes/MediaElementEditorDocumentReady.html">MediaElementEditorDocumentReady</a></li>
            
                <li><a href="../classes/MediaElementEditorForms.html">MediaElementEditorForms</a></li>
            
                <li><a href="../classes/MediaElementEditorHorizontalTimelines.html">MediaElementEditorHorizontalTimelines</a></li>
            
                <li><a href="../classes/NotificationsAccessories.html">NotificationsAccessories</a></li>
            
                <li><a href="../classes/NotificationsDocumentReady.html">NotificationsDocumentReady</a></li>
            
                <li><a href="../classes/NotificationsGraphics.html">NotificationsGraphics</a></li>
            
                <li><a href="../classes/PlayersAudioEditor.html">PlayersAudioEditor</a></li>
            
                <li><a href="../classes/PlayersCommon.html">PlayersCommon</a></li>
            
                <li><a href="../classes/PlayersDocumentReady.html">PlayersDocumentReady</a></li>
            
                <li><a href="../classes/PlayersGeneral.html">PlayersGeneral</a></li>
            
                <li><a href="../classes/PlayersVideoEditor.html">PlayersVideoEditor</a></li>
            
                <li><a href="../classes/ProfilePrelogin.html">ProfilePrelogin</a></li>
            
                <li><a href="../classes/ProfileUsers.html">ProfileUsers</a></li>
            
                <li><a href="../classes/SearchDocumentReady.html">SearchDocumentReady</a></li>
            
                <li><a href="../classes/TagsAccessories.html">TagsAccessories</a></li>
            
                <li><a href="../classes/TagsInitializers.html">TagsInitializers</a></li>
            
                <li><a href="../classes/UploaderDocumentReady.html">UploaderDocumentReady</a></li>
            
                <li><a href="../classes/UploaderGlobal.html">UploaderGlobal</a></li>
            
                <li><a href="../classes/UploaderLoadingBar.html">UploaderLoadingBar</a></li>
            
                <li><a href="../classes/VideoEditorAddComponents.html">VideoEditorAddComponents</a></li>
            
                <li><a href="../classes/VideoEditorComponents.html">VideoEditorComponents</a></li>
            
                <li><a href="../classes/VideoEditorCutters.html">VideoEditorCutters</a></li>
            
                <li><a href="../classes/VideoEditorDocumentReady.html">VideoEditorDocumentReady</a></li>
            
                <li><a href="../classes/VideoEditorGalleries.html">VideoEditorGalleries</a></li>
            
                <li><a href="../classes/VideoEditorGeneral.html">VideoEditorGeneral</a></li>
            
                <li><a href="../classes/VideoEditorPreview.html">VideoEditorPreview</a></li>
            
                <li><a href="../classes/VideoEditorPreviewAccessories.html">VideoEditorPreviewAccessories</a></li>
            
                <li><a href="../classes/VideoEditorReplaceComponents.html">VideoEditorReplaceComponents</a></li>
            
                <li><a href="../classes/VideoEditorScrollPain.html">VideoEditorScrollPain</a></li>
            
                <li><a href="../classes/VideoEditorTextComponentEditor.html">VideoEditorTextComponentEditor</a></li>
            
                <li><a href="../classes/VirtualClassroomDocumentReady.html">VirtualClassroomDocumentReady</a></li>
            
                <li><a href="../classes/VirtualClassroomJavaScriptAnimations.html">VirtualClassroomJavaScriptAnimations</a></li>
            
                <li><a href="../classes/VirtualClassroomMultipleLoading.html">VirtualClassroomMultipleLoading</a></li>
            
                <li><a href="../classes/VirtualClassroomSendLink.html">VirtualClassroomSendLink</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/admin.html">admin</a></li>
            
                <li><a href="../modules/ajax-loader.html">ajax-loader</a></li>
            
                <li><a href="../modules/audio-editor.html">audio-editor</a></li>
            
                <li><a href="../modules/browser-support.html">browser-support</a></li>
            
                <li><a href="../modules/buttons.html">buttons</a></li>
            
                <li><a href="../modules/dashboard.html">dashboard</a></li>
            
                <li><a href="../modules/dialogs.html">dialogs</a></li>
            
                <li><a href="../modules/galleries.html">galleries</a></li>
            
                <li><a href="../modules/general.html">general</a></li>
            
                <li><a href="../modules/image-editor.html">image-editor</a></li>
            
                <li><a href="../modules/jquery-browsers.html">jquery-browsers</a></li>
            
                <li><a href="../modules/jquery-patches.html">jquery-patches</a></li>
            
                <li><a href="../modules/lesson-editor.html">lesson-editor</a></li>
            
                <li><a href="../modules/lesson-viewer.html">lesson-viewer</a></li>
            
                <li><a href="../modules/media-element-editor.html">media-element-editor</a></li>
            
                <li><a href="../modules/notifications.html">notifications</a></li>
            
                <li><a href="../modules/players.html">players</a></li>
            
                <li><a href="../modules/profile.html">profile</a></li>
            
                <li><a href="../modules/search.html">search</a></li>
            
                <li><a href="../modules/tags.html">tags</a></li>
            
                <li><a href="../modules/uploader.html">uploader</a></li>
            
                <li><a href="../modules/video-editor.html">video-editor</a></li>
            
                <li><a href="../modules/virtual-classroom.html">virtual-classroom</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app/assets/javascripts/admin/functions.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
Functions used in the Administration section: only for this section, &lt;b&gt;it&#x27;s generated a separate file&lt;/b&gt; which doesn&#x27;t merge with the regular one. The only external module loaded is {{#crossLinkModule &quot;ajax-loader&quot;}}{{/crossLinkModule}}.
@module admin
**/





/**
Initializer for jQueryUI autocomplete on users serch into Admin Notifications.
@method initNotificationsAutocomplete
@for AdminAutocomplete
**/
function initNotificationsAutocomplete() {
  $(function() {
    function log(message, _id) {
      if($(&#x27;#&#x27; + _id).length === 0) {
        $(&#x27;&lt;div class=&quot;label label-info&quot; id=&quot;+_id+&quot;&gt;&#x27;).text(message).prependTo(&#x27;#log&#x27;).append(&#x27;&lt;a href=&quot;#&quot; class=&quot;del&quot;&gt;x&lt;/a&gt;&#x27;);
        $(&#x27;#log&#x27;).scrollTop(0);
        if($(&#x27;#search_users_ids&#x27;).val().length &gt; 0) {
          $(&#x27;#search_users_ids&#x27;).val($( &#x27;#search_users_ids&#x27;).val() + &#x27;,&#x27; + _id);
        } else {
          $(&#x27;#search_users_ids&#x27;).val(_id);
        }
        $(&#x27;#filter-users&#x27;).submit();
        var dup = $(&#x27;#contact-recipients&#x27;).clone();
        $(&#x27;#contact-recipients&#x27;).remove();
        $(dup).appendTo(&#x27;.recipients_input&#x27;);
        $(dup).val(&#x27;&#x27;);
        initNotificationsAutocomplete();
        $(&#x27;#contact-recipients&#x27;).focus();
      }
    }
    $(&#x27;#contact-recipients&#x27;).autocomplete({
      source: &#x27;/admin/users/get_full_names&#x27;,
      minLength: 2,
      select: function(event, ui) {
        log(ui.item ? ui.item.value : &#x27;No match&#x27; , ui.item.id);
      }
    });
  });
}





/**
Browser support checking, supported browsers version. It is empty. The not supported browsers version is implemented in {{#crossLink &quot;BrowserSupportMain/browserSupportMain:method&quot;}}{{/crossLink}}
@method adminBrowserSupport
@for AdminBrowserSupport
**/
function browserSupport() {
}





/**
Open a collapsed table row with extra content, tipically clicking on previous collapsable table row.
@method openAndLoadNextTr
@for AdminCollapsed
@param prevTr {Object} the previous element in the table
**/
function openAndLoadNextTr(prevTr) {
  var next_tr = prevTr.next(&#x27;tr.collapsed&#x27;);
  var thumb = next_tr.find(&#x27;.element-thumbnail&#x27;);
  if((thumb.length &gt; 0) &amp;&amp; !thumb.data(&#x27;loaded&#x27;)) {
    var el_id = next_tr.find(&#x27;.element-thumbnail&#x27;).data(&#x27;param&#x27;);
    $.ajax({
      url: &#x27;/admin/media_elements/&#x27; + el_id + &#x27;/load&#x27;,
      type: &#x27;get&#x27;
    });
  }
  next_tr.slideToggle(&#x27;slow&#x27;);
}





/**
Initializes the browser classes in the tag html. Same functionality as {{#crossLink &quot;GeneralDocumentReady/browsersDocumentReady:method&quot;}}{{/crossLink}}.
@method adminBrowsersDocumentReady
@for AdminDocumentReady
**/
function adminBrowsersDocumentReady() {
  if(!$.browser.msie) {
    $(&#x27;#admin-media-elements-quick-upload-form&#x27;).fileupload();
  } else {
    $(&#x27;#admin-media-elements-quick-upload-form&#x27;).append($(&#x27;&lt;input name=&quot;from_ie&quot; value=&quot;true&quot; style=&quot;display:none&quot; /&gt;&#x27;));
    $(&#x27;#hint_not_for_ie&#x27;).hide();
    $(&#x27;#qume_file&#x27;).change(function() {
      $(&#x27;#admin-media-elements-quick-upload-form&#x27;).submit();
    });
  }
}

/**
Initializes the effects of collapse and change date.
@method adminEffectsDocumentReady
@for AdminDocumentReady
**/
function adminEffectsDocumentReady() {
  var nowTemp = new Date();
  var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
  var checkin = $(&#x27;#dpd1&#x27;).datepicker({
    onRender: function(date) {
      return date.valueOf() &lt; now.valueOf() || (checkout &amp;&amp; date.valueOf() &lt; checkout.date.valueOf()) ? &#x27;disabled&#x27; : &#x27;&#x27;;
    }
  }).on(&#x27;changeDate&#x27;, function(ev) {
    if (ev.date.valueOf() &gt; checkout.date.valueOf()) {
      $(&#x27;#alert&#x27;).show();
      $(&#x27;#alert .start&#x27;).show();
      $(&#x27;#alert .end&#x27;).hide();
    } else {
      $(&#x27;#alert&#x27;).hide();
    }
    checkin.hide();
    $(&#x27;#dpd1&#x27;)[0].blur();
    $(&#x27;#dpd2&#x27;)[0].blur();
  }).data(&#x27;datepicker&#x27;);
  var checkout = $(&#x27;#dpd2&#x27;).datepicker({
    onRender: function(date) {
      return date.valueOf() &lt;= checkin.date.valueOf() ? &#x27;disabled&#x27; : &#x27;&#x27;;
    }
  }).on(&#x27;changeDate&#x27;, function(ev) {
    if (ev.date.valueOf() &lt; checkin.date.valueOf()) {
      $(&#x27;#alert&#x27;).show();
      $(&#x27;#alert .end&#x27;).show();
      $(&#x27;#alert .start&#x27;).hide();
    } else {
      $(&#x27;#alert&#x27;).hide();
    }
    checkout.hide();
    $(&#x27;#dpd1&#x27;)[0].blur();
    $(&#x27;#dpd2&#x27;)[0].blur();
  }).data(&#x27;datepicker&#x27;);
  $(&#x27;.dropdown&#x27;).click(function(e) {
    e.stopPropagation();
  });
  $body.on(&#x27;click&#x27;, &#x27;tr.collapse&#x27;, function(e) {
    var t = $(e.target);
    if(!(t.hasClass(&#x27;icon-eye-open&#x27;) || t.hasClass(&#x27;icon-remove&#x27;) || t.hasClass(&#x27;icon-globe&#x27;) || t.hasClass(&#x27;_user_link_in_admin&#x27;) || t.hasClass(&#x27;_link_in_admin&#x27;) || t.hasClass(&#x27;_report_item&#x27;) || t.hasClass(&#x27;_dont_report_item&#x27;))) {
      openAndLoadNextTr($(this));
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;#expand-all&#x27;, function(e) {
   e.preventDefault();
   $(&#x27;tr.collapsed&#x27;).slideDown(&#x27;slow&#x27;);
  });
  $body.on(&#x27;click&#x27;, &#x27;#collapse-all&#x27;, function(e) {
   e.preventDefault();
   $(&#x27;tr.collapsed&#x27;).slideUp(&#x27;slow&#x27;);
  });
}

/**
Initializes the locations filling. See similar {{#crossLink &quot;GeneralDocumentReady/locationsDocumentReady:method&quot;}}{{/crossLink}}.
@method adminLocationsDocumentReady
@for AdminDocumentReady
**/
function adminLocationsDocumentReady() {
  $(&#x27;._select_locations_admin&#x27;).on(&#x27;change&#x27;, function() {
    if(!$(this).data(&#x27;is-last&#x27;)) {
      if($(this).val() == &#x27;0&#x27;) {
        $(this).parents(&#x27;.control-group&#x27;).nextAll().find(&#x27;select&#x27;).html(&#x27;&#x27;);
      } else {
        $.ajax({
          url: &#x27;/admin/locations/&#x27; + $(this).val() + &#x27;/find&#x27;,
          type: &#x27;get&#x27;
        });
      }
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;.edit_admin_location&#x27;, function() {
    var father = $(&#x27;#admin_location_&#x27; + $(this).data(&#x27;location-id&#x27;));
    father.find(&#x27;.name_write&#x27;).show();
    father.find(&#x27;.name_readonly&#x27;).hide();
    father.find(&#x27;.code_write&#x27;).show();
    father.find(&#x27;.code_readonly&#x27;).hide();
    father.find(&#x27;.edit_admin_location_done&#x27;).show();
    father.find(&#x27;.edit_admin_location&#x27;).hide();
  });
  $body.on(&#x27;click&#x27;, &#x27;.edit_admin_location_done&#x27;, function() {
    var father = $(&#x27;#admin_location_&#x27; + $(this).data(&#x27;location-id&#x27;));
    $.ajax({
      url: &#x27;/admin/settings/locations/&#x27; + $(this).data(&#x27;location-id&#x27;) + &#x27;/update?name=&#x27; + father.find(&#x27;.name_write&#x27;).val() + &#x27;&amp;code=&#x27; + father.find(&#x27;.code_write&#x27;).val(),
      type: &#x27;put&#x27;
    });
  });
  $body.on(&#x27;click&#x27;, &#x27;.create_admin_location&#x27;, function() {
    $(&#x27;#create_admin_location_&#x27; + $(this).data(&#x27;location-type&#x27;) + &#x27; .create_admin_location_form&#x27;).show();
    $(this).hide();
  });
  $body.on(&#x27;click&#x27;, &#x27;.create_admin_location_form_done&#x27;, function() {
    var father = $(&#x27;#create_admin_location_&#x27; + $(this).data(&#x27;location-type&#x27;));
    $.ajax({
      url: &#x27;/admin/settings/locations/create?name=&#x27; + father.find(&#x27;.create_admin_location_name&#x27;).val() + &#x27;&amp;code=&#x27; + father.find(&#x27;.create_admin_location_code&#x27;).val() + &#x27;&amp;sti_type=&#x27; + $(this).data(&#x27;location-type-for-form&#x27;) + &#x27;&amp;parent=&#x27; + $(this).data(&#x27;location-parent&#x27;),
      type: &#x27;post&#x27;
    });
  });
  $body.on(&#x27;change&#x27;, &#x27;#admin_purchase_choose_location_kind&#x27;, function() {
    if($(this).val() == &#x27;0&#x27;) {
      $(&#x27;#admin_purchase_choose_location_wrapper select&#x27;).each(function() {
        $(this).attr(&#x27;disabled&#x27;, &#x27;disabled&#x27;).addClass(&#x27;disabled&#x27;).removeClass(&#x27;eletto&#x27;);
      });
      $(&#x27;#hidden_messages_for_admin_purchase_choose_location&#x27;).hide();
      var first = true;
      $(&#x27;._admin_purchase_choose_location_select_box&#x27;).each(function() {
        if(first) {
          $(this).find(&#x27;option&#x27;).not(&#x27;.dont_delete_me&#x27;).removeAttr(&#x27;selected&#x27;);
          $(this).find(&#x27;option.dont_delete_me&#x27;).attr(&#x27;selected&#x27;, &#x27;selected&#x27;);
        } else {
          $(this).find(&#x27;option&#x27;).not(&#x27;.dont_delete_me&#x27;).remove();
        }
        first = false;
      });
    } else {
      var me = $(&#x27;#admin_purchase_choose_location_&#x27; + $(this).val());
      me.removeAttr(&#x27;disabled&#x27;).removeClass(&#x27;disabled&#x27;).addClass(&#x27;eletto&#x27;);
      if(me.val() != &#x27;0&#x27;) {
        $(&#x27;#purchase_location_id&#x27;).val(me.val());
      }
      var prev = me.prevUntil(&#x27;._admin_purchase_choose_location_select_box&#x27;).prev();
      while(prev.length &gt; 0) {
        prev.removeAttr(&#x27;disabled&#x27;).removeClass(&#x27;disabled&#x27;).removeClass(&#x27;eletto&#x27;);
        prev = prev.prevUntil(&#x27;._admin_purchase_choose_location_select_box&#x27;).prev();
      }
      var next = me.nextUntil(&#x27;._admin_purchase_choose_location_select_box&#x27;).next();
      var first_next = true;
      while(next.length &gt; 0) {
        next.attr(&#x27;disabled&#x27;, &#x27;disabled&#x27;).addClass(&#x27;disabled&#x27;).removeClass(&#x27;eletto&#x27;);
        if(first_next) {
          next.find(&#x27;option.dont_delete_me&#x27;).attr(&#x27;selected&#x27;, &#x27;selected&#x27;);
        } else {
          next.find(&#x27;option&#x27;).not(&#x27;.dont_delete_me&#x27;).remove();
        }
        next = next.nextUntil(&#x27;._admin_purchase_choose_location_select_box&#x27;).next();
        first_next = false
      }
      $(&#x27;#hidden_messages_for_admin_purchase_choose_location&#x27;).show();
      var translated_location = $(this).find(&#x27;option.&#x27; + $(this).val()).data(&#x27;translated&#x27;);
      $(&#x27;#hidden_messages_for_admin_purchase_choose_location .location&#x27;).html(translated_location);
      $(&#x27;#get_location_by_code_or_id&#x27;).data(&#x27;type&#x27;, $(this).val());
    }
  });
  $body.on(&#x27;change&#x27;, &#x27;._admin_purchase_choose_location_select_box&#x27;, function() {
    var me = $(this);
    if(me.val() != &#x27;0&#x27;) {
      if(!me.data(&#x27;last&#x27;)) {
        $.ajax({
          type: &#x27;get&#x27;,
          url: &#x27;/admin/purchases/locations/&#x27; + me.val() + &#x27;/find&#x27;
        });
      }
      if(me.hasClass(&#x27;eletto&#x27;)) {
        $(&#x27;#purchase_location_id&#x27;).val(me.val());
      } else {
        $(&#x27;#open_location_administrator&#x27;).attr(&#x27;href&#x27;, &#x27;/admin/settings/locations?selected=&#x27; + me.val());
      }
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;#get_location_by_code_or_id&#x27;, function() {
    $.ajax({
      type: &#x27;get&#x27;,
      url: &#x27;/admin/purchases/locations/fill?&#x27; + $(&#x27;#get_location_code_type&#x27;).val() + &#x27;=&#x27; + $(&#x27;#get_location_code&#x27;).val() + &#x27;&amp;sti_type=&#x27; + $(this).data(&#x27;type&#x27;)
    });
  });
}

/**
Initializes effects for MediaElement.
@method adminMediaElementsDocumentReady
@for AdminDocumentReady
**/
function adminMediaElementsDocumentReady() {
  $body.on(&#x27;focus&#x27;, &#x27;._quick_load_creation_form ._qume_title&#x27;, function() {
    var placeholder = $(this).parents(&#x27;._quick_load_creation_form&#x27;).find(&#x27;._qume_title_placeholder&#x27;);
    if(placeholder.val() != &#x27;&#x27;) {
      placeholder.val(&#x27;&#x27;);
      $(this).val(&#x27;&#x27;);
    }
  });
  $body.on(&#x27;focus&#x27;, &#x27;._quick_load_creation_form ._qume_description&#x27;, function() {
    var placeholder = $(this).parents(&#x27;._quick_load_creation_form&#x27;).find(&#x27;._qume_description_placeholder&#x27;);
    if(placeholder.val() != &#x27;&#x27;) {
      placeholder.val(&#x27;&#x27;);
      $(this).val(&#x27;&#x27;);
    }
  });
  $body.on(&#x27;focus&#x27;, &#x27;._quick_load_creation_form ._qume_tags&#x27;, function() {
    var placeholder = $(this).parents(&#x27;._quick_load_creation_form&#x27;).find(&#x27;._qume_tags_placeholder&#x27;);
    if(placeholder.val() != &#x27;&#x27;) {
      placeholder.val(&#x27;&#x27;);
      $(this).val(&#x27;&#x27;);
    }
  });
  $body.on(&#x27;click&#x27;, &#x27;._create_new_element&#x27;, function() {
    $.ajax({
      type: &#x27;post&#x27;,
      data: $(this).parents(&#x27;._quick_load_creation_form&#x27;).serialize(),
      url: &#x27;/admin/media_elements/&#x27; + $(this).data(&#x27;param&#x27;) + &#x27;/create&#x27;
    });
  });
  $body.on(&#x27;click&#x27;, &#x27;._delete_new_element&#x27;, function() {
    $.ajax({
      type: &#x27;delete&#x27;,
      url: &#x27;/admin/media_elements/quick_upload/&#x27; + $(this).data(&#x27;param&#x27;) + &#x27;/delete&#x27;
    });
  });
  $body.on(&#x27;click&#x27;,&#x27;.action._publish_list_element i&#x27;, function(e) {
    e.preventDefault();
    $.ajax({
      type: &#x27;put&#x27;,
      url: &#x27;/admin/media_elements/&#x27; + $(this).parent(&#x27;a&#x27;).data(&#x27;param&#x27;) + &#x27;?is_public=true&#x27;,
      timeout: 5000,
      success: function() {
        var btn = $(e.target);
        btn.remove();
      }
    });
  });
  $body.on(&#x27;click&#x27;, &#x27;._publish_private_admin_element&#x27;, function() {
    $.ajax({
      type: &#x27;put&#x27;,
      data: $(this).parents(&#x27;._quick_load_creation_form&#x27;).serialize(),
      url: &#x27;/admin/media_elements/&#x27; + $(this).data(&#x27;param&#x27;) + &#x27;/update?is_public=true&#x27;
    });
  });
  $body.on(&#x27;click&#x27;, &#x27;._update_private_admin_element&#x27;, function() {
    $.ajax({
      type: &#x27;put&#x27;,
      data: $(this).parents(&#x27;._quick_load_creation_form&#x27;).serialize(),
      url: &#x27;/admin/media_elements/&#x27; + $(this).data(&#x27;param&#x27;) + &#x27;/update&#x27;
    });
  });
  initNotificationsAutocomplete();
  $body.on(&#x27;click&#x27;, &#x27;#log .del&#x27;, function(e) {
    e.preventDefault();
    var my_div = $(this).parent(&#x27;div&#x27;)
    var ids_val = $(&#x27;#search_users_ids&#x27;).val().split(&#x27;,&#x27;);
    ids_val.splice(ids_val.indexOf(my_div.attr(&#x27;id&#x27;)), 1);
    $(&#x27;#search_users_ids&#x27;).val(ids_val);
    my_div.remove();
    $(&#x27;#filter-users&#x27;).submit();
  });
  $body.on(&#x27;click&#x27;,&#x27;._filter_and_send&#x27;, function(e) {
    e.preventDefault();
    if(!$(this).hasClass(&#x27;disabled&#x27;)) {
      $form = $(this).parents(&#x27;form&#x27;);
      $form.find(&#x27;#send_message&#x27;).val(true);
      $form.submit();
      $form.find(&#x27;#send_message&#x27;).val(&#x27;&#x27;);
    }
  });
}

/**
Initializes actions for less important tables, such as Tag, Subject, SchoolLevel 
@method adminMiscellaneaDocumentReady
@for AdminDocumentReady
**/
function adminMiscellaneaDocumentReady() {
  $body.on(&#x27;click&#x27;, &#x27;ul.subjects li a i.icon-remove&#x27;, function() {
    var _id = $(this).parents(&#x27;li&#x27;).data(&#x27;param&#x27;);
    $.ajax({
      type: &#x27;delete&#x27;,
      url: &#x27;/admin/settings/subjects/&#x27; + _id + &#x27;/delete&#x27;
    });
  });
  $body.on(&#x27;click&#x27;, &#x27;ul.school_levels li a i.icon-remove&#x27;, function() {
    $.ajax({
      type: &#x27;delete&#x27;,
      url: &#x27;/admin/settings/school_levels/&#x27; + $(this).parents(&#x27;li&#x27;).data(&#x27;param&#x27;) + &#x27;/delete&#x27;
    });
  });
  $body.on(&#x27;click&#x27;, &#x27;._dont_report_item&#x27;, function() {
    $.ajax({
      type: &#x27;delete&#x27;,
      url: &#x27;reports/&#x27; + $(this).data(&#x27;report-id&#x27;) + &#x27;/decline&#x27;
    });
  });
  $body.on(&#x27;click&#x27;, &#x27;._report_item&#x27;, function() {
    $.ajax({
      type: &#x27;delete&#x27;,
      url: &#x27;reports/&#x27; + $(this).data(&#x27;report-id&#x27;) + &#x27;/accept&#x27;
    });
  });
  $body.on(&#x27;click&#x27;, &#x27;#new_purchase #renewed&#x27;, function() {
    $(&#x27;#purchase_accounts_number&#x27;).val($(this).data(&#x27;accounts-number&#x27;));
    $(&#x27;#renewed_id&#x27;).val($(this).data(&#x27;renewed-id&#x27;));
  });
  $body.on(&#x27;focus&#x27;, &#x27;#purchase_accounts_number&#x27;, function() {
    $(&#x27;#renewed_id&#x27;).val(&#x27;&#x27;);
  });
}

/**
Initializes effects for the administration search engine.
@method adminSearchDocumentReady
@for AdminDocumentReady
**/
function adminSearchDocumentReady() {
  if($(&#x27;#search_date_range&#x27;).find(&#x27;option:selected&#x27;).val() &amp;&amp; ($(&#x27;#search_date_range&#x27;).find(&#x27;option:selected&#x27;).val().length &gt; 0)) {
    $(&#x27;.datepick&#x27;).removeAttr(&#x27;disabled&#x27;);
  }
  $(&#x27;#search_date_range&#x27;).on(&#x27;change&#x27;, function() {
    var selected = $(this).find(&#x27;option:selected&#x27;).val();
    if(selected.length &gt; 0) {
      $(&#x27;.datepick&#x27;).removeAttr(&#x27;disabled&#x27;);
    } else {
      $(&#x27;.datepick&#x27;).attr(&#x27;disabled&#x27;, &#x27;disabled&#x27;);
    }
  });
  $body.on(&#x27;change&#x27;, &#x27;#filter-users select&#x27;, function() {
    var selected = $(this).find(&#x27;option:selected&#x27;).first();
    var text = selected.text().replace(/\s+/g, &#x27; &#x27;);
    var select_id = $(this).attr(&#x27;id&#x27;);
    if($(&#x27;._filter_select.&#x27; + select_id).length &gt; 0){
      if(selected.val().length &gt; 0) {
        if(selected.val() != 0){
          $(&#x27;.&#x27; + select_id + &#x27; span&#x27;).text(text);
        } else {
          $(&#x27;#&#x27; + select_id).parents(&#x27;.control-group&#x27;).nextAll().find(&#x27;select&#x27;).each(function(){
            $(&#x27;.&#x27; + $(this).attr(&#x27;id&#x27;)).remove();
          });
          $(&#x27;.&#x27; + select_id).remove();
        }
      } else {
        $(&#x27;.&#x27; + select_id).remove();
      }
    } else {
      $(&#x27;&lt;div class=&quot;label _filter_select &#x27; + select_id + &#x27;&quot;&gt;&#x27;).html(&#x27;&lt;span&gt;&#x27; + text + &#x27;&lt;/span&gt;&#x27;).prependTo(&#x27;#log&#x27;);
    }
    $(&#x27;#filter-users&#x27;).submit();
  });
  $(&#x27;#all_users&#x27;).change(function() {
      if(this.checked) {
        $(&#x27;._filter_and_send&#x27;).removeClass(&#x27;disabled&#x27;);
        $(&#x27;input#contact-recipients&#x27;).val(&#x27;&#x27;);
        $(&#x27;input#contact-recipients&#x27;).attr(&#x27;disabled&#x27;,true);
        $(&#x27;#log&#x27;).html(&#x27;&#x27;);
        $(&#x27;._users_count_label&#x27;).text($(&#x27;._users_count_label&#x27;).data(&#x27;all-selected&#x27;));
        $(&#x27;#filter-users select&#x27;).each(function(){
          $this = $(this);
          $this.find(&#x27;option:selected&#x27;).removeAttr(&#x27;selected&#x27;);
          $this.attr(&#x27;disabled&#x27;,true);
        });
        $(&#x27;#log&#x27;).html(&#x27;&#x27;);
      } else {
        $(&#x27;._filter_and_send&#x27;).addClass(&#x27;disabled&#x27;);
        $(&#x27;input#contact-recipients&#x27;).attr(&#x27;disabled&#x27;, false);
        $(&#x27;#filter-users select&#x27;).attr(&#x27;disabled&#x27;, false);
        $(&#x27;._users_count_label&#x27;).text($(&#x27;._users_count_label&#x27;).data(&#x27;zero-selected&#x27;));
      }
  });
}

/**
Initializes effects for sorting in administration search engine.
@method adminSortingDocumentReady
@for AdminDocumentReady
**/
function adminSortingDocumentReady() {
  $body.on(&#x27;click&#x27;, &#x27;table#lessons-list thead tr th a&#x27;, function(e) {
    e.preventDefault();
    $(&#x27;input#search_ordering&#x27;).val($(this).data(&#x27;ordering&#x27;));
    $(&#x27;input#search_desc&#x27;).val($(this).data(&#x27;desc&#x27;));
    $(&#x27;#admin-search-lessons&#x27;).submit();
  });
  $body.on(&#x27;click&#x27;, &#x27;table#elements-list thead tr th a&#x27;, function(e) {
    e.preventDefault();
    $(&#x27;input#search_ordering&#x27;).val($(this).data(&#x27;ordering&#x27;));
    $(&#x27;input#search_desc&#x27;).val($(this).data(&#x27;desc&#x27;));
    $(&#x27;#admin-search-elements&#x27;).submit();
  });
  $body.on(&#x27;click&#x27;, &#x27;table#users-list thead tr th a&#x27;, function(e) {
    e.preventDefault();
    $(&#x27;input#search_ordering&#x27;).val($(this).data(&#x27;ordering&#x27;));
    $(&#x27;input#search_desc&#x27;).val($(this).data(&#x27;desc&#x27;));
    $(&#x27;#admin-search-users&#x27;).submit();
  });
  $body.on(&#x27;click&#x27;, &#x27;table#tags-list thead tr th a&#x27;, function(e) {
    e.preventDefault();
    $(&#x27;input#search_ordering&#x27;).val($(this).data(&#x27;ordering&#x27;));
    $(&#x27;input#search_desc&#x27;).val($(this).data(&#x27;desc&#x27;));
    $(&#x27;#admin-search-tags&#x27;).submit();
  });
  $body.on(&#x27;click&#x27;, &#x27;table#documents-list thead tr th a&#x27;, function(e) {
    e.preventDefault();
    $(&#x27;input#search_ordering&#x27;).val($(this).data(&#x27;ordering&#x27;));
    $(&#x27;input#search_desc&#x27;).val($(this).data(&#x27;desc&#x27;));
    $(&#x27;#admin-search-documents&#x27;).submit();
  });
  $body.on(&#x27;click&#x27;, &#x27;table#purchases-list thead tr th a&#x27;, function(e) {
    e.preventDefault();
    $(&#x27;input#search_ordering&#x27;).val($(this).data(&#x27;ordering&#x27;));
    $(&#x27;input#search_desc&#x27;).val($(this).data(&#x27;desc&#x27;));
    $(&#x27;#admin-search-purchases&#x27;).submit();
  });
}

/**
Initializes effects for User.
@method adminUsersDocumentReady
@for AdminDocumentReady
**/
function adminUsersDocumentReady() {
  $body.on(&#x27;click&#x27;, &#x27;._active_status&#x27;, function(e) {
    e.preventDefault();
    var link = $(this);
    var status = true;
    if(link.hasClass(&#x27;ban&#x27;)) {
      status = false;
    }
    $.ajax({
      url: &#x27;/admin/users/&#x27; + link.data(&#x27;param&#x27;) + &#x27;/set_status?active=&#x27; + status,
      type: &#x27;put&#x27;
    });
  });
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
